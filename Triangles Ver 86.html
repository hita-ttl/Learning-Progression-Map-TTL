<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Grade 10: Triangles - Competency-Level Map</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            overflow: hidden;
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cg transform='rotate(-45 16 16)'%3E%3Crect x='13' y='6' width='6' height='20' fill='%23ffd700' stroke='%23e6c200' stroke-width='0.5'/%3E%3Crect x='13' y='14' width='6' height='4' fill='%23ff8c00'/%3E%3Crect x='13' y='26' width='6' height='3' fill='%23c0c0c0'/%3E%3Crect x='13' y='29' width='6' height='5' rx='1' fill='%23ffb6c1' stroke='%23ff91a4' stroke-width='0.5'/%3E%3Crect x='13' y='2' width='6' height='4' fill='%23f4d1a6'/%3E%3Cpath d='M16,0 L13,4 L19,4 Z' fill='%234a4a4a'/%3E%3Cline x1='16' y1='1' x2='16' y2='4' stroke='%232a2a2a' stroke-width='0.5'/%3E%3C/g%3E%3C/svg%3E") 4 4, auto;
        }

        /* Top info bar */
        .top-info-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #e8f4fd;
            padding: 15px 20px;
            border-bottom: 1px solid #d1e3f0;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .top-info-bar h1 {
            font-size: 20px;
            color: #1976d2;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        /* Subsection headers in Grade 10 */
        .subsection-header {
            font-size: 14px;
            font-weight: bold;
            color: #666;
            margin-top: 20px;
            margin-bottom: 10px;
            padding: 5px 10px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 4px;
        }

        .top-info-bar .instructions {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .competency-symbol {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: white;
            border: 2px solid #ffd700;
            border-radius: 50%;
            margin: 0 4px;
        }

        .top-info-bar .note {
            font-size: 12px;
            color: #666;
            font-style: italic;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            padding-top: 90px; /* Account for top bar */
        }

        .left-panel {
            width: 320px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .controls {
            padding: 20px;
            padding-top: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .level-selector {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 0;
            position: relative;
        }

        .level-selector h3 {
            font-size: 14px;
            margin-bottom: 12px;
            color: #333;
            font-weight: 600;
        }

        .level-option {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
            position: relative;
        }

        .level-option:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .level-header {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .level-checkbox {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            cursor: pointer;
        }

        .level-indicator {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 8px;
            font-size: 12px;
            color: white;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
        }

        .level-1 { background: #2196f3; }
        .level-2 { background: #ff9800; }

        .level-name {
            font-weight: 600;
            font-size: 13px;
            color: #333;
            flex: 1;
        }

        .level-description {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-size: 11px;
            width: 250px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
            line-height: 1.5;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* Show tooltip on hover but keep it within panel bounds */
        .level-option:hover .level-description {
            opacity: 1;
            left: 10px;
            right: 10px;
            width: auto;
            top: 100%;
            transform: translateY(5px);
            margin-left: 0;
            z-index: 1001;
        }
        
        .level-option:last-child {
            margin-bottom: 0;
        }

        .prerequisites-panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .prerequisites-panel.show {
            display: block;
        }

        .prerequisites-panel h3 {
            font-size: 14px;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .prerequisite-section {
            margin-bottom: 20px;
        }

        .prerequisite-section h4 {
            font-size: 13px;
            color: #555;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .prerequisite-item {
            padding: 8px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 11px;
            border-left: 3px solid #ddd;
            transition: all 0.3s ease;
        }

        .prerequisite-item.level-1 {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }

        .prerequisite-item.level-2 {
            background: #fff3e0;
            border-left-color: #ff9800;
        }

        .prerequisite-item.grade-6 {
            border-right: 3px solid #8b4513;
        }

        .prerequisite-item.grade-7 {
            border-right: 3px solid #228b22;
        }

        .prerequisite-item.grade-8 {
            border-right: 3px solid #800080;
        }

        .prerequisite-item.grade-9 {
            border-right: 3px solid #4169e1;
        }
        
        .prerequisite-item.grade-10 {
            border-right: 3px solid #ffd700;
        }

        .prerequisite-code {
            font-weight: bold;
            color: #2c3e50;
            display: block;
            margin-bottom: 4px;
        }

        .prerequisite-desc {
            color: #555;
            line-height: 1.4;
        }

        .main-area {
            flex: 1;
            position: relative;
            overflow: auto;
        }

        #metro-svg {
            min-width: 1800px;
            min-height: 1200px;
            background: white;
        }

        /* Station styles */
        .station {
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cg transform='rotate(-45 16 16)'%3E%3Crect x='13' y='6' width='6' height='20' fill='%23ffd700' stroke='%23e6c200' stroke-width='0.5'/%3E%3Crect x='13' y='14' width='6' height='4' fill='%23ff8c00'/%3E%3Crect x='13' y='26' width='6' height='3' fill='%23c0c0c0'/%3E%3Crect x='13' y='29' width='6' height='5' rx='1' fill='%23ffb6c1' stroke='%23ff91a4' stroke-width='0.5'/%3E%3Crect x='13' y='2' width='6' height='4' fill='%23f4d1a6'/%3E%3Cpath d='M16,0 L13,4 L19,4 Z' fill='%234a4a4a'/%3E%3Cline x1='16' y1='1' x2='16' y2='4' stroke='%232a2a2a' stroke-width='0.5'/%3E%3C/g%3E%3C/svg%3E") 4 4, pointer;
            transition: all 0.3s ease;
        }

        .station-circle {
            fill: white;
            stroke-width: 2;
            transition: all 0.3s ease;
        }

        /* Dimmed station styles */
        .station.dimmed {
            opacity: 0.3;
        }

        .station.dimmed .station-circle {
            stroke-width: 1;
        }

        .station.dimmed .station-label {
            opacity: 0.5;
        }

        /* Pencil indicator styles */
        .pencil-indicator {
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .pencil-indicator.active {
            opacity: 1;
        }

        .station.grade-6 .station-circle { stroke: #8b4513; }
        .station.grade-7 .station-circle { stroke: #228b22; }
        .station.grade-8 .station-circle { stroke: #800080; }
        .station.grade-9 .station-circle { stroke: #4169e1; }
        .station.grade-10 .station-circle { 
            stroke: #ffd700; 
            stroke-width: 3;
            fill: #fffacd;
        }

        .station.highlighted .station-circle {
            stroke-width: 4;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.8));
        }

        .station.active .station-circle {
            stroke-width: 4;
            filter: drop-shadow(0 0 6px rgba(0, 0, 0, 0.4));
        }

        .station-label {
            font-size: 9px;
            fill: #333;
            pointer-events: none;
            opacity: 0.8;
            transition: all 0.3s ease;
            text-anchor: start;
        }

        .station.active .station-label,
        .station.highlighted .station-label {
            opacity: 1;
            font-weight: bold;
            font-size: 11px;
        }

        /* Grade zones */
        .grade-zone {
            fill: none;
            stroke-width: 2;
            stroke-dasharray: 10, 5;
            opacity: 0.2;
        }

        .grade-6-zone { stroke: #8b4513; fill: #8b451308; }
        .grade-7-zone { stroke: #228b22; fill: #228b2208; }
        .grade-8-zone { stroke: #800080; fill: #80008008; }
        .grade-9-zone { stroke: #4169e1; fill: #4169e108; }
        .grade-10-zone { 
            stroke: #d4a017; 
            fill: #fff5d6;
            stroke-width: 4;
            stroke-dasharray: 15, 8;
            opacity: 0.6;
        }

        .zone-label {
            font-size: 20px;
            font-weight: bold;
            fill: #999;
            opacity: 0.3;
        }

        .zone-label.grade-10 {
            fill: #000;
            opacity: 1;
        }

        /* Sequential path styles */
        .sequential-path {
            fill: none;
            stroke-width: 3;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .sequential-path.active {
            opacity: 1;
        }
        
        .sequential-path.level-1 {
            stroke: #2196f3;
        }
        
        .sequential-path.level-2 {
            stroke: #ff9800;
        }

        /* Connection paths */
        .connection-path {
            fill: none;
            stroke: #ff6b6b;
            stroke-width: 2;
            stroke-dasharray: 5, 3;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .connection-path.active {
            opacity: 0;
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip.persistent {
            pointer-events: all;
        }
        
        /* Second tooltip for hover when one is persistent */
        .tooltip-hover {
            position: fixed;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 999;
            max-width: 300px;
        }
        
        .tooltip-hover.show {
            opacity: 1;
        }

        .tooltip .code {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .see-more-btn {
            background: #ffd700;
            color: #000;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
            margin-top: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .see-more-btn:hover {
            background: #ffed4e;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
    background-color: white;
    margin: auto;
    padding: 30px;
    border-radius: 8px;
    width: 95%;
    max-width: 1200px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333;
            font-size: 18px;
        }

        .close-modal {
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            line-height: 20px;
        }

        .close-modal:hover {
            color: #000;
        }

        .modal-table {
            width: 100%;
            border-collapse: collapse;
        }

        .modal-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            font-size: 13px;
        }

        .modal-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            font-size: 12px;
            line-height: 1.5;
        }

        .modal-table tr:last-child td {
            border-bottom: none;
        }

/* Quiz Player Styles */
.quiz-player {
    display: none;
    position: fixed;
    z-index: 3000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    overflow-y: auto;
}

.quiz-player.show {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
}

.quiz-content {
    max-width: 700px;
    width: 90%;
    max-height: 85vh;
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    position: relative;
    overflow-y: auto;
}

.quiz-close {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 24px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
    z-index: 1;
    line-height: 1;
}

.quiz-close:hover {
    color: #000;
}

.quiz-header {
    background: #f0f4ff;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    margin-top: 25px;
}

.quiz-title {
    color: #764ba2;
    text-align: center;
    margin-bottom: 10px;
    font-size: 1.3em;
    font-weight: 600;
}

.quiz-progress {
    font-size: 1em;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
    text-align: center;
}

.quiz-competency {
    color: #764ba2;
    font-size: 0.85em;
    text-align: center;
    line-height: 1.3;
    max-width: 100%;
    word-wrap: break-word;
}

.stimulus-box {
    background: #e8f4fd;
    padding: 12px;
    border-left: 4px solid #2196F3;
    border-radius: 6px;
    margin-bottom: 15px;
    font-size: 0.9em;
}

.stimulus-label {
    font-weight: bold;
    color: #1976D2;
    margin-bottom: 6px;
    font-size: 0.9em;
}

.question-stem {
    font-size: 1.1em;
    line-height: 1.5;
    color: #333;
    padding: 18px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    margin-bottom: 20px;
    border: 1px solid #e0e0e0;
}

.options-grid {
    display: grid;
    gap: 10px;
    margin-bottom: 15px;
}

.option-card {
    padding: 12px;
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    font-size: 0.95em;
}

.option-card:hover:not(.disabled) {
    background: #f8f9fa;
    border-color: #667eea;
    transform: translateX(3px);
}

.option-card.disabled {
    cursor: not-allowed;
}

.option-card.correct {
    background: #e8f5e9;
    border-color: #4caf50;
}

.option-card.incorrect {
    background: #ffebee;
    border-color: #f44336;
}

.option-label {
    display: inline-block;
    width: 26px;
    height: 26px;
    background: #667eea;
    color: white;
    text-align: center;
    line-height: 26px;
    border-radius: 50%;
    margin-right: 10px;
    font-weight: bold;
    font-size: 0.9em;
}

.option-card.correct .option-label {
    background: #4caf50;
}

.option-card.incorrect .option-label {
    background: #f44336;
}

.rationale-box {
    display: none;
    margin-top: 10px;
    padding: 10px;
    background: #fff3cd;
    border-radius: 6px;
    font-size: 0.85em;
    color: #856404;
    line-height: 1.4;
}

.rationale-box.show {
    display: block;
}

.quiz-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 2px solid #e0e0e0;
}

.quiz-nav-group {
    display: flex;
    gap: 8px;
}

.quiz-nav-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.quiz-nav-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.quiz-nav-btn.primary {
    background: #28a745;
    color: white;
}

.quiz-nav-btn.secondary {
    background: #6c757d;
    color: white;
}

.quiz-nav-btn:not(:disabled):hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}

/* Responsive adjustments */
@media (max-width: 1366px) {
    .quiz-content {
        max-width: 650px;
        padding: 18px;
    }
    
    .quiz-title {
        font-size: 1.2em;
    }
    
    .quiz-competency {
        font-size: 0.8em;
    }
    
    .question-stem {
        font-size: 1.05em;
        padding: 16px;
    }
}

@media (max-width: 1024px) {
    .quiz-content {
        max-width: 600px;
        width: 92%;
    }
    
    .quiz-title {
        font-size: 1.15em;
    }
}

@media (max-width: 768px) {
    .quiz-content {
        margin: 10px;
        padding: 15px;
        border-radius: 10px;
        width: 95%;
    }
    
    .quiz-close {
        top: 12px;
        right: 15px;
        font-size: 22px;
    }
    
    .quiz-title {
        font-size: 1.1em;
    }
    
    .question-stem {
        padding: 12px;
        font-size: 1em;
    }
    
    .quiz-navigation {
        flex-direction: column;
        gap: 10px;
    }
    
    .quiz-nav-group {
        width: 100%;
        justify-content: space-between;
    }
}

/* Quiz button styles */
.quiz-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px;
    transition: all 0.3s ease;
}

.quiz-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.quiz-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}

/* Quiz Player Styles */
.quiz-player {
    display: none;
    position: fixed;
    z-index: 3000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    overflow-y: auto;
}

.quiz-player.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ... (add all other quiz CSS here) ... */
        
        /* Zoom controls */
        .zoom-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 100;
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: #f0f0f0;
            transform: scale(1.1);
        }

        .info-section {
            background: #e8f4fd;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 11px;
            color: #1976d2;
            line-height: 1.5;
        }

        .info-section strong {
            display: block;
            margin-bottom: 4px;
        }
        
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            .top-info-bar {
                padding: 10px 15px;
            }
            
            .top-info-bar h1 {
                font-size: 16px;
            }
            
            .top-info-bar .instructions {
                font-size: 12px;
            }
            
            .top-info-bar .note {
                font-size: 10px;
            }
            
            .container {
                padding-top: 80px;
                flex-direction: column;
            }
            
            .left-panel {
                width: 100%;
                height: 40vh;
                order: 2;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            }
            
            .main-area {
                height: 60vh;
                order: 1;
            }
            
            .controls {
                padding: 15px;
                padding-top: 10px;
            }
            
            .level-selector h3 {
                font-size: 13px;
                margin-bottom: 10px;
            }
            
            .level-option {
                padding: 8px;
                margin-bottom: 8px;
            }
            
            .level-name {
                font-size: 12px;
            }
            
            .level-indicator {
                width: 20px;
                height: 20px;
                font-size: 10px;
                line-height: 20px;
            }
            
            /* Hide hover tooltips on mobile */
            .level-option .level-description {
                display: none;
            }
            
            .zoom-controls {
                top: 10px;
                right: 10px;
            }
            
            .zoom-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .tooltip {
                font-size: 11px;
                max-width: 250px;
            }
            
            .prerequisite-section h4 {
                font-size: 12px;
            }
            
            .prerequisite-item {
                padding: 6px;
                margin-bottom: 6px;
                font-size: 10px;
            }

            .modal-content {
                width: 95%;
                padding: 15px;
            }

            .modal-table {
                font-size: 11px;
            }

            .modal-table th,
            .modal-table td {
                padding: 8px;
            }
        }
        
        /* Very small mobile screens */
        @media (max-width: 480px) {
            .top-info-bar h1 {
                font-size: 14px;
            }
            
            .container {
                padding-top: 75px;
            }
            
            .left-panel {
                height: 45vh;
            }
            
            .main-area {
                height: 55vh;
            }
        }
    </style>
</head>
<body>
    <div class="top-info-bar">
        <h1>Learning Progression Map: Grade 10, Chapter Triangles</h1>
        <div class="instructions">
            <span>How to use: Select a competency (</span>
            <span class="competency-symbol"></span>
            <span>) from the highlighted box, then select a prerequisite level from the panel on the left.</span>
        </div>
        <div class="note">Note: The highlighted box contains all competencies for the selected grade and chapter. The other boxes show only the prerequisite competencies needed to understand the selected chapter.</div>
    </div>
    
    <div class="container">
        <div class="left-panel">
            <div class="controls">
                <div class="level-selector">
                    <h3>Prerequisite Levels</h3>
                    
                    <div class="level-option">
                        <div class="level-header">
                            <input type="checkbox" class="level-checkbox" id="level-1">
                            <span class="level-indicator level-1">1</span>
                            <label for="level-1" class="level-name">Immediate Prerequisites</label>
                        </div>
                        <div class="level-description">
                            Competencies that need to be mastered right before the selected competency
                        </div>
                    </div>
                    
                    <div class="level-option">
                        <div class="level-header">
                            <input type="checkbox" class="level-checkbox" id="level-2">
                            <span class="level-indicator level-2">2</span>
                            <label for="level-2" class="level-name">Supporting Prerequisites</label>
                        </div>
                        <div class="level-description">
                            Competencies that enable the immediate prerequisites
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="prerequisites-panel" id="prerequisites-panel">
                <h3>Prerequisites for Selected Competency</h3>
                <div id="prerequisites-content"></div>
            </div>
        </div>

        <div class="main-area">
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <button class="zoom-btn" onclick="zoomOut()">−</button>
                <button class="zoom-btn" onclick="resetZoom()">⟲</button>
            </div>

            <svg id="metro-svg"></svg>
            
            <div class="tooltip"></div>
            <div class="tooltip-hover"></div>
        </div>
    </div>

    <!-- Modal for Grade 10 details -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Competency Details</h2>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <!-- Tables will be dynamically inserted here -->
        </div>
    </div>
    
   <!-- Quiz Player -->
<div id="quizPlayer" class="quiz-player">
    <div class="quiz-content">
        <span class="quiz-close" onclick="closeQuiz()">&times;</span>
        <div class="quiz-header">
            <h3 class="quiz-title">Quiz</h3>
            <div class="quiz-progress">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">1</span></div>
            <div class="quiz-competency" id="quizCompetency"></div>
        </div>
        <div id="quizBody">
            <div id="stimulusBox" class="stimulus-box" style="display: none;">
                <div class="stimulus-label">Context/Stimulus:</div>
                <div id="stimulusContent"></div>
            </div>
            
            <div class="question-stem" id="questionText"></div>
            
            <div id="optionsGrid" class="options-grid"></div>
        </div>
        <div class="quiz-navigation">
            <button class="quiz-nav-btn secondary" id="prevBtn" onclick="prevQuestion()">Previous</button>
            <div class="quiz-nav-group">
                <button class="quiz-nav-btn secondary" onclick="closeQuiz()">Exit</button>
                <button class="quiz-nav-btn primary" id="nextBtn" onclick="nextQuestion()">Next</button>
            </div>
        </div>
    </div>
</div>

    <script>
        // Competency data from masterfiles
        const competencyData = {
            "G10-TRI-6.1-01": {"competency": "Can differentiate between congruent and similar figures", "chapter": "Triangles", "subsection": "Introduction", "misconception": "1. Students may claim that all congruent figures are similar but not all similar figures are congruent.\n2. Students may think congruent figures can have different shapes if their sizes are the same.\n3. Students may think similar figures must be exactly the same in both shape and size.", "misconceptionExample": "1. When asked whether congruent figures are similar, a student says yes, but when asked if similar figures are congruent, they also say yes.\n2. A student says a square and a rectangle of the same area are congruent because they have the same \"size\".\n3. Two triangles with same angles but different side lengths are rejected as similar because they're not identical.", "reasoning": "1. Students don't realize congruent is a special case of similar where the scale factor is 1.\n2. Students confuse properties - they focus on one aspect (area/perimeter) rather than shape preservation.\n3. Students conflate similarity with congruence, not understanding that similar figures can be different sizes.", "learningResource": "https://youtu.be/g9GxZ52T4NY?si=a6UVo_d3gVFTZS7l", "grade": 10},
            "G10-TRI-6.2-01": {"competency": "Can identify similar figures and explain why they are similar", "chapter": "Triangles", "subsection": "Similar Figures", "misconception": "1. Students may think that any two polygons with the same number of sides are always similar, even if their angles and side ratios differ.\n2. Students may think that two figures cannot be similar if one is rotated or flipped in a different direction.\n3. Students may think figures are similar just because they \"look alike\" without checking angle equality or side ratios\n4. Students may think figures of different shapes (like square and rectangle) can be similar if one looks like a stretched version of the other\n5. Students may think similarity requires both equal angles and equal side lengths (confusing with congruence)\n6. Students may think only triangles can be similar, not other polygons\n7. Students may think similarity can be proved by comparing only one pair of angles or sides instead of all required pairs", "misconceptionExample": "1. A square and a rhombus both have 4 sides. A student may wrongly assume they are similar just because both have same number of side.\n2. Two identical equilateral triangles, where one is rotated upside down. A student may think they are not similar because they \"look different\". \n3. Two triangles drawn roughly with slanted sides are judged as similar just by appearance, without checking ratios\n4. A student says a 4 cm × 4 cm square and a 4 cm × 6 cm rectangle are similar\n5. A student says two equilateral triangles with sides 3 cm and 6 cm are not similar because side lengths are not equal\n6. A student ignores the fact that two rectangles with sides 2 cm × 4 cm and 4 cm × 8 cm are similar\n7. A student checks only one pair of angles equal in two triangles and concludes they are similar", "reasoning": "1. Students overgeneralize by focusing only on the number of sides and ignore the need to check angles and side ratios.\n2. Students confuse orientation with shape property and think turning a figure changes its similarity. \n3. Students rely on visual impression rather than mathematical checks\n4. Students overgeneralize the idea of \"stretching\" as similarity between any figures\n5. Students confuse similarity with congruence due to overlap of the words \"same shape\" and \"same size\"\n6. Students mostly practice similarity with triangles, so they assume it applies only to triangles\n7. Students do not fully apply the definition of similarity, stopping after checking only one condition", "learningResource": "https://youtu.be/rPQ2IooGRPg?si=Nh64x009C07ESyr4", "grade": 10},
            "G10-TRI-6.2-02": {"competency": "Can determine if two polygons are similar by verifying corresponding angles are equal and corresponding sides are proportional", "chapter": "Triangles", "subsection": "Similar Figures", "misconception": "1. Students may not establish proper correspondence and check angles/sides randomly.\n2. Students may check only angles or only sides, not both.\n3. Students may use differences instead of ratios when checking proportionality.\n4. Students may expect all ratios to be whole numbers.\n5. Students may not maintain order when setting up proportions.", "misconceptionExample": "1. In triangles ABC and PQR, student compares angle A with angle Q instead of angle P.\n2. Student verifies all angles are equal and concludes triangles are similar without checking sides.\n3. Student says sides 6,8,10 and 9,12,15 are proportional because differences are 3,4,5.\n4. Student says sides 3,4,5 and 6,8,10 are not proportional because 3/6 = 0.5 is \"not a proper ratio\".\n5. Student writes 3/6 = 5/8 instead of 3/6 = 4/8 = 5/10.", "reasoning": "1. Students don't understand that correspondence must be based on matching properties.\n2. Students remember partial conditions for similarity.\n3. Students confuse arithmetic patterns with geometric proportionality.\n4. Students have limited understanding of ratios and expect nice numbers.\n5. Students don't systematically organize corresponding parts.", "learningResource": "https://youtu.be/rPQ2IooGRPg?si=Nh64x009C07ESyr4", "grade": 10},
            "G10-TRI-6.2-03": {"competency": "Can calculate scale factor and use it to find unknown measurements in similar figures", "chapter": "Triangles", "subsection": "Similar Figures", "misconception": "1. Students may think scale factor is always greater than 1.\n2. Students may use the wrong direction for scale factor (larger to smaller vs smaller to larger).\n3. Students may apply scale factor by adding/subtracting instead of multiplying.\n4. Students may apply scale factor to angles as well as sides.\n5. Students may not square the scale factor when dealing with areas.", "misconceptionExample": "1. When triangle A is enlarged to triangle B, student says scale factor cannot be 0.5.\n2. If small triangle has side 3 and large has side 6, student says scale factor is 0.5.\n3. With scale factor 2 and side 5cm, student calculates new side as 5+2=7cm.\n4. With scale factor 3, student says 40° angle becomes 120°.\n5. If sides have ratio 1:3, student says areas have ratio 1:3.", "reasoning": "1. Students associate scaling with enlargement only.\n2. Students don't establish clear direction for comparison.\n3. Students confuse multiplicative and additive reasoning.\n4. Students overgeneralize that everything scales proportionally.\n5. Students don't understand dimensional analysis in scaling.", "learningResource": "https://youtu.be/oc2cwjk538k?si=bqts6uxFkTkdT-LQ", "grade": 10},
            "G10-TRI-6.3-01": {"competency": "Can apply the Basic Proportionality Theorem (Thales Theorem) to solve problems", "chapter": "Triangles", "subsection": "Similarity of Triangles", "misconception": "1. Students may think any line through a triangle creates proportional segments.\n2. Students may apply the theorem when the line is not parallel to any side.\n3. Students may use wrong segments in the proportion.\n4. Students may think the theorem only works for midpoints.", "misconceptionExample": "1. A random line through triangle assumed to create proportional segments.\n2. Line through two sides but not parallel to third, student still applies BPT.\n3. In triangle with parallel line, student uses whole sides instead of segments.\n4. Student says BPT only valid when parallel line passes through midpoints.", "reasoning": "1. Students don't understand the parallel condition is essential.\n2. Students memorize the theorem without understanding conditions.\n3. Students confuse which segments are proportional.\n4. Students overgeneralize from special cases they've seen.", "learningResource": "https://youtu.be/jR8wbl-uz_0?si=TYBIoSvdXQfmdAkZ", "grade": 10},
            "G10-TRI-6.3-02": {"competency": "Can prove and apply that a line parallel to one side of a triangle divides the other two sides proportionally", "chapter": "Triangles", "subsection": "Similarity of Triangles", "misconception": "1. Students may assume the result without proving it.\n2. Students may not use similarity of triangles in the proof.\n3. Students may confuse this with the converse theorem.\n4. Students may think the line must be inside the triangle.", "misconceptionExample": "1. Student states \"parallel lines create proportional segments\" as if it's an axiom.\n2. Student attempts algebraic proof without using similar triangles.\n3. When asked to prove BPT, student proves the converse instead.\n4. Student says theorem fails when parallel line is drawn outside the triangle.", "reasoning": "1. Students treat theorems as facts without understanding need for proof.\n2. Students don't connect BPT to similarity concepts.\n3. Students confuse theorem and its converse.\n4. Students have limited visualization of geometric configurations.", "learningResource": "https://youtu.be/jR8wbl-uz_0?si=O52AAwh9Rm9Uyech", "grade": 10},
            "G10-TRI-6.3-03": {"competency": "Can prove and apply the converse of Basic Proportionality Theorem", "chapter": "Triangles", "subsection": "Similarity of Triangles", "misconception": "1. Students may assume if sides are divided equally, the line is parallel.\n2. Students may not understand what needs to be proved in a converse.\n3. Students may apply the converse incorrectly to non-triangular figures.", "misconceptionExample": "1. If segments are 3,3 and 4,4, student says line is parallel without checking ratios.\n2. Asked to prove converse, student proves the original theorem again.\n3. Student applies converse to a quadrilateral without proper justification.", "reasoning": "1. Students confuse equal lengths with proportional division.\n2. Students don't understand the logical structure of converse statements.\n3. Students overgeneralize theorems beyond their scope.", "learningResource": "https://youtu.be/OFnEEdARA3U?si=VLQm1OLaWLmM8NnX", "grade": 10},
            "G10-TRI-6.3-04": {"competency": "Can use properties of similar triangles to solve complex problems involving multiple triangles", "chapter": "Triangles", "subsection": "Similarity of Triangles", "misconception": "1. Students may not identify all pairs of similar triangles in a figure.\n2. Students may use properties from one pair incorrectly in another pair.\n3. Students may not set up correct proportion chains.\n4. Students may assume triangles are similar without verification.", "misconceptionExample": "1. In a figure with 3 similar triangles, student identifies only one pair.\n2. Ratio from triangles ABC~DEF applied directly to triangles DEF~GHI.\n3. Student writes separate proportions instead of combining them.\n4. Student assumes all triangles in a diagram are similar to each other.", "reasoning": "1. Students lack systematic approach to analyze complex figures.\n2. Students don't track which ratios belong to which triangle pairs.\n3. Students don't understand transitive properties of proportions.\n4. Students overgeneralize from simpler problems.", "learningResource": "https://youtu.be/OFnEEdARA3U?si=VLQm1OLaWLmM8NnX", "grade": 10},
            "G10-TRI-6.4-01": {"competency": "Can apply AAA (or AA) similarity criterion to prove triangles are similar", "chapter": "Triangles", "subsection": "Criteria for Similarity of Triangles", "misconception": "1. Students may think all three angles must be explicitly verified.\n2. Students may confuse AA similarity with AAA congruence (which doesn't exist).\n3. Students may not use angle sum property efficiently.", "misconceptionExample": "1. Given two angles equal, student says \"can't determine similarity without third angle\".\n2. Student claims triangles are congruent because all angles are equal.\n3. Student measures all three angles instead of using 180° sum.", "reasoning": "1. Students don't realize two angles determine the third.\n2. Students conflate similarity and congruence criteria.\n3. Students don't apply angle sum property strategically.", "learningResource": "https://youtu.be/5XT79Gjhi1s?si=ALCP1VW9kW1ags7D", "grade": 10},
            "G10-TRI-6.4-02": {"competency": "Can apply SSS similarity criterion to prove triangles are similar", "chapter": "Triangles", "subsection": "Criteria for Similarity of Triangles", "misconception": "1. Students may check if sides are equal instead of proportional.\n2. Students may check only two ratios instead of all three.\n3. Students may not maintain proper correspondence when forming ratios.\n4. Students may accept approximate ratios as exact.", "misconceptionExample": "1. Sides 3,4,5 and 6,8,10: student says not similar because 3≠6.\n2. Student verifies 3/6 = 4/8 and concludes similarity without checking 5/10.\n3. Student writes 3/6 = 4/10 = 5/8 with mixed correspondence.\n4. Ratios 0.5, 0.52, 0.49 accepted as \"all equal to 0.5\".", "reasoning": "1. Students confuse similarity with congruence.\n2. Students think partial verification is sufficient.\n3. Students don't systematically match corresponding sides.\n4. Students have weak understanding of proportion precision.", "learningResource": "https://youtu.be/WuZ8ouIdAus?si=RcA74GIxg6LUCOI_", "grade": 10},
            "G10-TRI-6.4-03": {"competency": "Can apply SAS similarity criterion to prove triangles are similar", "chapter": "Triangles", "subsection": "Criteria for Similarity of Triangles", "misconception": "1. Students may use any angle between the sides.\n2. Students may check if sides are equal rather than proportional.\n3. Students may use SSA instead of SAS.\n4. Students may not verify the angle is included between the given sides.", "misconceptionExample": "1. With sides AB, AC and angle B, student applies SAS.\n2. Sides 4,6 and 8,12 with equal included angle - student says not similar.\n3. Student uses two sides and non-included angle for SAS.\n4. Student doesn't check which angle is between the given sides.", "reasoning": "1. Students don't understand \"included angle\" concept.\n2. Students confuse similarity with congruence criteria.\n3. Students don't distinguish between SAS and SSA.\n4. Students memorize criteria without understanding structure.", "learningResource": "https://youtu.be/5UQiINhg8qI?si=ygvX6ubsozQjIMQm", "grade": 10},
            "G10-TRI-6.4-04": {"competency": "Can determine which similarity criterion to use in a given problem", "chapter": "Triangles", "subsection": "Criteria for Similarity of Triangles", "misconception": "1. Students may always default to one criterion.\n2. Students may not analyze what information is given.\n3. Students may try to use congruence criteria for similarity.\n4. Students may force inappropriate criteria when information is insufficient.", "misconceptionExample": "1. Student always tries AA even when only sides are given.\n2. Given all sides, student attempts to find angles for AA criterion.\n3. Student tries to use RHS for similarity problems.\n4. With insufficient data, student assumes missing information.", "reasoning": "1. Students don't flexibly choose strategies.\n2. Students don't systematically analyze given information.\n3. Students mix up similarity and congruence criteria.\n4. Students feel compelled to solve even with insufficient data.", "learningResource": "https://youtu.be/APeRE-ROy8E?si=Yzp-t9iZreDAOf1s", "grade": 10},
            "G10-TRI-6.4-05": {"competency": "Can solve real-world problems using triangle similarity", "chapter": "Triangles", "subsection": "Criteria for Similarity of Triangles", "misconception": "1. Students may not identify similar triangles in real situations.\n2. Students may assume measurements that aren't given.\n3. Students may not account for units in calculations.\n4. Students may use direct proportion where inverse is needed.", "misconceptionExample": "1. In shadow problem, student doesn't see the similar triangles formed.\n2. Student assumes person and building are perpendicular to ground.\n3. Height in meters and shadow in feet leads to incorrect ratio.\n4. Closer object having longer shadow calculated incorrectly.", "reasoning": "1. Students struggle to abstract geometric relationships from real contexts.\n2. Students don't consider physical constraints and assumptions.\n3. Students compute mechanically without checking units.\n4. Students apply proportional reasoning without understanding context.", "learningResource": "https://youtu.be/UH_NSCYPcdc?si=r68thlTSWL2qC3Ct", "grade": 10},
            "G10-TRI-6.4-06": {"competency": "Can distinguish between similarity and congruence criteria and apply them correctly", "chapter": "Triangles", "subsection": "Criteria for Similarity of Triangles", "misconception": "1. Students may think congruence criteria work for similarity.\n2. Students may think similar figures are always congruent.\n3. Students may mix criteria (e.g., using SAS congruence for similarity).\n4. Students may not recognize when to use which concept.", "misconceptionExample": "1. Student uses SSS congruence (equal sides) to prove similarity.\n2. \"These triangles are similar, so they must be congruent.\"\n3. Student checks if two sides and included angle are equal for similarity.\n4. Given equal shapes, student checks proportionality instead of equality.", "reasoning": "1. Students see criteria as interchangeable rules.\n2. Students don't understand similarity as generalization of congruence.\n3. Students memorize criteria without understanding differences.\n4. Students lack conceptual understanding of when each applies.", "learningResource": "", "grade": 10},
            "G10-TRI-ADV-01": {"competency": "Can prove properties of similar triangles including ratios of corresponding altitudes and medians", "chapter": "Triangles", "subsection": "Extended Learning", "misconception": "1. Students may think only sides are proportional in similar triangles.\n2. Students may use side ratio for area ratio.\n3. Students may not identify corresponding altitudes correctly.", "misconceptionExample": "1. Student says altitudes are equal in similar triangles.\n2. If sides ratio is 2:3, student says area ratio is also 2:3.\n3. Student pairs altitude from vertex A with altitude from vertex C.", "reasoning": "1. Students don't extend proportionality to other segments.\n2. Students don't understand dimensional analysis.\n3. Students don't maintain correspondence for special segments.", "learningResource": "https://youtu.be/jR8wbl-uz_0?si=9TsCbTResJFCm6Np", "grade": 10},
            "G10-TRI-ADV-02": {"competency": "Can apply similarity concepts to prove theorems like Pythagoras theorem", "chapter": "Triangles", "subsection": "Extended Learning", "misconception": "1. Students may not see how similarity relates to Pythagoras theorem.\n2. Students may not identify the similar triangles in the proof.\n3. Students may use the theorem to prove itself.", "misconceptionExample": "1. \"Pythagoras theorem is about right triangles, not similarity.\"\n2. In right triangle with altitude, student sees only two triangles.\n3. Student uses a²+b²=c² in the proof of Pythagoras theorem.", "reasoning": "1. Students compartmentalize different topics.\n2. Students don't analyze figures systematically.\n3. Students don't understand circular reasoning.", "learningResource": "https://youtu.be/tVYkIW_nWao?si=Ll7cbhmczYGXEqrh", "grade": 10},
            // Grade 6 competencies
            "G6-LA-2.2-01": {"competency": "Can identify a line segment as the shortest path between two points and denote it correctly", "chapter": "Lines and Angles", "subsection": "Line Segment", "misconception": "Students may think the curved path between two points is a line segment.  \r\nStudents confuse a line segment with a line or ray.", "grade": 6},
            "G6-LA-2.5-01": {"competency": "Can identify an angle as formed by two rays with a common starting point (vertex)", "chapter": "Lines and Angles", "subsection": "Angles", "misconception": "1. Students may think that angles can be formed by two line segments or two lines.  \r\n2. Students may think that longer rays create bigger angles.", "grade": 6},
            "G6-LA-2.5-02": {"competency": "Can understand that the size of an angle depends on the amount of rotation not the length of arms", "chapter": "Lines and Angles", "subsection": "Angles", "misconception": "1. Students may think that an angle with longer arms is larger than one with shorter arms.  \r\n2. Students may think the size of an angle depends on the arc drawn between the arms.", "grade": 6},
            "G6-LA-2.8-02": {"competency": "Can identify a right angle as exactly half of a straight angle measuring 90°", "chapter": "Lines and Angles", "subsection": "Right and Straight Angles", "misconception": "1. Students may think that any angle that looks approximately perpendicular is a right angle.  \r\n2. Students may think right angles can only appear in specific orientations (e.g., like an \"L\" shape).", "grade": 6},
            "G6-LA-2.8-03": {"competency": "Can classify angles as acute right obtuse or straight based on their measures", "chapter": "Lines and Angles", "subsection": "Right and Straight Angles", "misconception": "1. Students may classify angles based on appearance rather than actual measurement.  \r\n2. Students may think an angle slightly less than 90° is still a right angle.  \r\n3. Students may confuse obtuse angles (greater than 90°) with reflex angles.", "grade": 6},
            "G6-LA-2.9-02": {"competency": "Can use a protractor correctly to measure angles", "chapter": "Lines and Angles", "subsection": "Measuring Angles", "misconception": "Students may read from the wrong scale on the protractor.  \r\nStudents may not align the vertex of the angle with the center of the protractor.  \r\nStudents may not align one arm of the angle with the zero line of the protractor.", "grade": 6},
            "G6-LA-2.9-03": {"competency": "Can measure angles by aligning one arm with 0° and reading where the other arm points", "chapter": "Lines and Angles", "subsection": "Measuring Angles", "misconception": "1. Students may read the angle from the wrong scale (inner vs. outer).  \r\n2. Students may start measuring from 180° instead of 0°.  \r\n3. Students may read the supplement of the angle instead of the angle itself.", "grade": 6},
            "G6-LA-2.10-01": {"competency": "Can draw angles of given measures using a protractor", "chapter": "Lines and Angles", "subsection": "Drawing Angles", "misconception": "1. Students may draw the angle on the wrong side of the initial ray.  \r\n2. Students may mark the wrong scale reading when drawing the angle.  \r\n3. Students may not draw rays from the vertex through the marked point.", "grade": 6},
            "G6-LA-2.11-04": {"competency": "Can solve problems involving angle relationships in straight lines", "chapter": "Lines and Angles", "subsection": "Angle Relationships", "misconception": "1. Students may not recognize that angles on a straight line sum to 180°.  \r\n2. Students may add angles that are not on the same straight line.  \r\n3. Students may assume adjacent angles are always supplementary.", "grade": 6},
            "G6-LA-2.11-05": {"competency": "Can identify angles in real-world contexts like clocks doors and swings", "chapter": "Lines and Angles", "subsection": "Angle Relationships", "misconception": "1. Students may not visualize the angle between clock hands correctly.  \r\n2. Students may measure the wrong angle (e.g., reflex instead of the smaller angle).  \r\n3. Students may not identify the vertex in real-world angle situations.", "grade": 6},
            "G6-LA-NA-02": {"competency": "Can understand that perpendicular lines meet at right angles", "chapter": "Lines and Angles", "subsection": "Perpendicular Lines", "misconception": "1. Students may think perpendicular lines must be horizontal and vertical.  \r\n2. Students may think lines that look approximately perpendicular are perpendicular.  \r\n3. Students may confuse perpendicular with parallel lines.", "grade": 6},
            "G6-PC-8.0-02": {"competency": "Can use compass to transfer lengths without measuring", "chapter": "Practical Geometry", "subsection": "Using Compass", "misconception": "Students may change the compass width while transferring.  \r\nStudents may not maintain the same compass opening throughout the transfer.  \r\nStudents may try to measure with a ruler instead of using the compass.", "grade": 6},
            "G6-PC-8.1-03": {"competency": "Can use a compass to draw circles with a given radius", "chapter": "Practical Geometry", "subsection": "Drawing Circles", "misconception": "1. Students may confuse radius with diameter.  \r\n2. Students may not keep the compass point fixed while drawing.  \r\n3. Students may change the compass width while drawing the circle.", "grade": 6},
            "G6-PC-8.3-02": {"competency": "Can construct perpendicular lines using geometric tools", "chapter": "Practical Geometry", "subsection": "Perpendicular Construction", "misconception": "1. Students may draw lines that look perpendicular without proper construction.  \r\n2. Students may not use arcs of equal radius in the construction.  \r\n3. Students may confuse the construction of perpendiculars with parallel lines.", "grade": 6},
            "G6-SYM-9.1-02": {"competency": "Can verify if a line is a line of symmetry by checking if the two parts overlap completely when folded along that line", "chapter": "Symmetry", "subsection": "Line of Symmetry", "misconception": "1. Students may think any line through a figure is a line of symmetry.  \r\n2. Students may identify partial overlap as complete symmetry.  \r\n3. Students may think symmetric figures must have only one line of symmetry.", "grade": 6},
            // Grade 7 competencies
            "G7-PIL-5.1-02": {"competency": "Can identify and measure the four angles formed when two lines intersect", "chapter": "Pairs of Lines", "subsection": "Intersecting Lines", "misconception": "1. Students think only two angles are formed when lines intersect.  \r\n2. Students don't recognize vertically opposite angles.  \r\n3. Students think all four angles must be equal.", "grade": 7},
            "G7-PIL-5.3-02": {"competency": "Can identify parallel lines as lines on the same plane that never meet however far extended", "chapter": "Pairs of Lines", "subsection": "Parallel Lines", "misconception": "1. Students think parallel lines must be horizontal.  \r\n2. Students think lines that look parallel are parallel.  \r\n3. Students think parallel lines meet at infinity.", "grade": 7},
            "G7-PIL-5.5-01": {"competency": "Can identify a transversal as a line that intersects two other lines and recognize that 8 angles are formed", "chapter": "Pairs of Lines", "subsection": "Transversal", "misconception": "1. Students may count only 4 or 6 angles instead of 8.  \r\n2. Students think a transversal must be perpendicular.  \r\n3. Students think the two lines must be parallel for a transversal.", "grade": 7},
            "G7-PIL-5.6-01": {"competency": "Can identify corresponding angles formed when a transversal intersects two lines", "chapter": "Pairs of Lines", "subsection": "Corresponding Angles", "misconception": "1. Students confuse corresponding angles with alternate angles.  \r\n2. Students think corresponding angles are always equal.  \r\n3. Students match angles incorrectly as corresponding.", "grade": 7},
            "G7-PIL-5.6-02": {"competency": "Can apply the property that corresponding angles are equal when a transversal crosses parallel lines", "chapter": "Pairs of Lines", "subsection": "Corresponding Angles", "misconception": "1. Students apply this property to non-parallel lines.  \r\n2. Students think only some corresponding angles are equal.  \r\n3. Students confuse with vertically opposite angles.", "grade": 7},
            "G7-PIL-5.7-01": {"competency": "Can construct parallel lines using ruler and set square based on equal corresponding angles", "chapter": "Pairs of Lines", "subsection": "Constructing Parallel Lines", "misconception": "1. Students draw freehand instead of using tools.  \r\n2. Students don't maintain the same angle.  \r\n3. Students think equidistant lines are always parallel.", "grade": 7},
            "G7-PIL-5.8-01": {"competency": "Can identify alternate angles formed by a transversal and recognize they are equal for parallel lines", "chapter": "Pairs of Lines", "subsection": "Alternate Angles", "misconception": "1. Students confuse alternate interior with alternate exterior.  \r\n2. Students think alternate angles are equal for any two lines.  \r\n3. Students identify wrong pairs as alternate angles.", "grade": 7},
            "G7-PIL-5.8-02": {"competency": "Can use relationships between corresponding and vertically opposite angles to prove alternate angles are equal", "chapter": "Pairs of Lines", "subsection": "Alternate Angles", "misconception": "1. Students don't see the connection between angle types.  \r\n2. Students use circular reasoning in proofs.  \r\n3. Students assume what they need to prove.", "grade": 7},
            "G7-PIL-NA-01": {"competency": "Can solve complex problems involving multiple parallel lines and transversals", "chapter": "Pairs of Lines", "subsection": "Complex Problems", "misconception": "1. Students apply properties incorrectly with multiple transversals.  \r\n2. Students lose track of which angles correspond.  \r\n3. Students assume all lines in a figure are parallel.", "grade": 7},
            "G7-TTIL-7.1-02": {"competency": "Can construct an equilateral triangle using compass and ruler when given a side length", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Equilateral Triangles", "misconception": "1. Students draw by approximation instead of construction.  \r\n2. Students don't use equal radii for all arcs.  \r\n3. Students confuse with isosceles triangle construction.", "grade": 7},
            "G7-TTIL-7.2-02": {"competency": "Can construct a triangle given three side lengths using compass and ruler", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Triangle Construction", "misconception": "1. Students don't check triangle inequality first.  \r\n2. Students use ruler to measure instead of compass.  \r\n3. Students draw arcs from wrong vertices.", "grade": 7},
            "G7-TTIL-7.2-03": {"competency": "Can apply the triangle inequality theorem to determine if given lengths can form a triangle", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Triangle Inequality", "misconception": "1. Students check only one inequality instead of all three.  \r\n2. Students think sum can equal the third side.  \r\n3. Students check difference instead of sum.", "grade": 7},
            "G7-TTIL-7.3-01": {"competency": "Can construct a triangle given two sides and the included angle (SAS)", "chapter": "A Tale of Three Intersecting Lines", "subsection": "SAS Construction", "misconception": "1. Students use non-included angle.  \r\n2. Students don't measure angle accurately.  \r\n3. Students confuse with SSA construction.", "grade": 7},
            "G7-TTIL-7.3-04": {"competency": "Can prove that the sum of angles in any triangle equals 180° using parallel lines", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Angle Sum Property", "misconception": "1. Students may memorize the proof without understanding it.  \r\n2. Students may think the property applies only to specific types of triangles.  \r\n3. Students may confuse the property with exterior angles.", "grade": 7},
            "G7-TTIL-7.3-05": {"competency": "Can find the third angle of a triangle given two angles", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Finding Angles", "misconception": "1. Students add the given angles instead of subtracting from 180°.  \r\n2. Students forget to subtract from 180°.  \r\n3. Students think all angles must be equal.", "grade": 7},
            "G7-TTIL-7.3-06": {"competency": "Can identify and calculate exterior angles of triangles", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Exterior Angles", "misconception": "1. Students confuse exterior with interior angles.  \r\n2. Students think exterior angle equals adjacent interior.  \r\n3. Students measure the wrong angle as exterior.", "grade": 7},
            "G7-TTIL-7.3-07": {"competency": "Can apply the exterior angle theorem (exterior angle equals sum of non-adjacent interior angles)", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Exterior Angle Theorem", "misconception": "1. Students add all three interior angles.  \r\n2. Students use adjacent interior angle.  \r\n3. Students think theorem works for any polygon.", "grade": 7},
            "G7-TTIL-7.4-01": {"competency": "Can identify and construct altitudes of triangles from vertices to opposite sides", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Altitudes", "misconception": "1. Students draw to nearest point, not perpendicular.  \r\n2. Students think altitude must be inside triangle.  \r\n3. Students confuse altitude with median.", "grade": 7},
            "G7-TTIL-7.4-02": {"competency": "Can construct altitudes using set square and ruler for precise perpendiculars", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Altitude Construction", "misconception": "1. Students draw freehand perpendiculars.  \r\n2. Students don't extend base when needed.  \r\n3. Students measure instead of constructing.", "grade": 7},
            "G7-TTIL-7.5-01": {"competency": "Can classify triangles by sides (equilateral, isosceles, scalene) and angles (acute, right, obtuse)", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Triangle Classification", "misconception": "1. Students think isosceles must have two sides equal, not at least two.  \r\n2. Students think obtuse triangles have all obtuse angles.  \r\n3. Students classify by appearance not measurement.", "grade": 7},
            "G7-TTIL-7.5-02": {"competency": "Can identify that acute triangles have all angles less than 90° while obtuse triangles have one angle greater than 90°", "chapter": "A Tale of Three Intersecting Lines", "subsection": "Angle-based Classification", "misconception": "1. Students think acute means one acute angle.  \r\n2. Students think obtuse triangles have multiple obtuse angles.  \r\n3. Students forget about right triangles in classification.", "grade": 7},
            // Grade 8 competencies
            "G8-UQ-3.1-01": {"competency": "Can identify and classify curves as simple closed curves and polygons", "chapter": "Understanding Quadrilaterals", "subsection": "Polygons", "misconception": "1. Students think all closed curves are polygons.  \r\n2. Students include curves with crossing sides.  \r\n3. Students think circles are polygons.", "grade": 8},
            "G8-UQ-3.2-01": {"competency": "Can calculate and verify that the sum of exterior angles of any polygon is 360°", "chapter": "Understanding Quadrilaterals", "subsection": "Exterior Angles", "misconception": "1. Students think sum depends on number of sides.  \r\n2. Students add interior angles instead.  \r\n3. Students count reflex angles as exterior.", "grade": 8},
            "G8-UQ-3.2-02": {"competency": "Can find the measure of each exterior angle in a regular polygon", "chapter": "Understanding Quadrilaterals", "subsection": "Regular Polygons", "misconception": "1. Students divide by wrong number.  \r\n2. Students use interior angle formula.  \r\n3. Students think all polygons have equal exterior angles.", "grade": 8},
            "G8-UQ-3.3-03": {"competency": "Can identify parallelograms and use properties of opposite sides and angles", "chapter": "Understanding Quadrilaterals", "subsection": "Parallelograms", "misconception": "1. Students think any quadrilateral with parallel sides is a parallelogram.  \r\n2. Students think all angles are equal.  \r\n3. Students confuse with trapezium.", "grade": 8},
            "G8-UQ-3.3.4-01": {"competency": "Can identify and use relationships between adjacent and opposite elements in parallelograms", "chapter": "Understanding Quadrilaterals", "subsection": "Parallelogram Properties", "misconception": "1. Students think adjacent angles are equal.  \r\n2. Students think diagonals are equal.  \r\n3. Students apply properties to non-parallelograms.", "grade": 8},
            // Grade 9 competencies
            "G9-EG-2-03": {"competency": "Can state and apply Euclid's axioms in mathematical reasoning", "chapter": "Euclid's Geometry", "subsection": "Axioms and Postulates", "misconception": "1. Students think axioms need proof.  \r\n2. Students confuse axioms with theorems.  \r\n3. Students don't see axioms as foundation.", "grade": 9},
            "G9-EG-2-08": {"competency": "Can prove simple geometric statements using Euclid's axioms and postulates", "chapter": "Euclid's Geometry", "subsection": "Geometric Proofs", "misconception": "1. Students skip logical steps.  \r\n2. Students use theorems not yet proved.  \r\n3. Students confuse assumption with conclusion.", "grade": 9},
            "G9-EG-3-02": {"competency": "Can differentiate between proved statements (theorems) and accepted truths (axioms/postulates)", "chapter": "Euclid's Geometry", "subsection": "Theorems vs Axioms", "misconception": "1. Students think all statements need proof.  \r\n2. Students think axioms are less important.  \r\n3. Students use terms interchangeably.", "grade": 9},
            "G9-EG-4-02": {"competency": "Can appreciate the role of logical reasoning and proof in mathematics", "chapter": "Euclid's Geometry", "subsection": "Importance of Proof", "misconception": "1. Students think proofs are just formality.  \r\n2. Students rely on visual evidence alone.  \r\n3. Students don't see need for rigor.", "grade": 9},
            "G9-LA-1-01": {"competency": "Can identify and explain real-world applications of lines and angles in architecture and science", "chapter": "Lines and Angles", "subsection": "Real-world Applications", "misconception": "1. Students don't see geometry in real life.  \r\n2. Students think applications are approximate.  \r\n3. Students separate math from reality.", "grade": 9},
            "G9-LA-2-01": {"competency": "Can distinguish between lines, line segments and rays and use appropriate notation", "chapter": "Lines and Angles", "subsection": "Basic Definitions", "misconception": "1. Students use terms interchangeably.  \r\n2. Students use wrong notation.  \r\n3. Students think ray has two endpoints.", "grade": 9},
            "G9-LA-2-02": {"competency": "Can identify and classify different types of angles (acute, right, obtuse, straight, reflex)", "chapter": "Lines and Angles", "subsection": "Angle Types", "misconception": "1. Students don't recognize reflex angles.  \r\n2. Students measure from wrong side.  \r\n3. Students think straight angle is not an angle.", "grade": 9},
            "G9-LA-2-03": {"competency": "Can identify adjacent angles and understand their properties including common vertex and arm", "chapter": "Lines and Angles", "subsection": "Adjacent Angles", "misconception": "1. Students think any two angles next to each other are adjacent.  \r\n2. Students think adjacent angles must be equal.  \r\n3. Students think adjacent angles always sum to 180°.", "grade": 9},
            "G9-LA-6-01": {"competency": "Can identify and use properties of angles formed by a transversal with parallel lines (corresponding, alternate interior, co-interior)", "chapter": "Lines and Angles", "subsection": "Transversal Properties", "misconception": "1. Students mix up angle types.  \r\n2. Students apply to non-parallel lines.  \r\n3. Students don't identify all angle pairs.", "grade": 9},
            "G9-LA-6-02": {"competency": "Can use angle properties to prove lines are parallel (converse theorems)", "chapter": "Lines and Angles", "subsection": "Proving Parallel Lines", "misconception": "1. Students assume lines are parallel.  \r\n2. Students use original theorem as converse.  \r\n3. Students check only one angle pair.", "grade": 9},
            "G9-LA-6-03": {"competency": "Can solve complex problems involving parallel lines and transversals including finding multiple unknown angles", "chapter": "Lines and Angles", "subsection": "Complex Angle Problems", "misconception": "1. Students solve angles randomly.  \r\n2. Students don't use all given information.  \r\n3. Students make arithmetic errors.", "grade": 9},
            "G9-LA-7-01": {"competency": "Can construct geometric proofs using properties of lines and angles including deductive reasoning", "chapter": "Lines and Angles", "subsection": "Geometric Proofs", "misconception": "1. Students use circular reasoning.  \r\n2. Students skip steps.  \r\n3. Students don't state reasons clearly.", "grade": 9},
            "G9-LA-8-01": {"competency": "Can apply angle properties to solve real-world problems involving parallel and intersecting lines", "chapter": "Lines and Angles", "subsection": "Applications", "misconception": "1. Students don't model situation correctly.  \r\n2. Students ignore physical constraints.  \r\n3. Students use wrong properties.", "grade": 9},
            "G9-TRI-7.1-01": {"competency": "Can identify triangles and describe their basic elements (sides, angles, vertices) and notation", "chapter": "Triangles", "subsection": "Triangle Basics", "misconception": "1. Students confuse vertices with angles.  \r\n2. Students use wrong notation order.  \r\n3. Students count elements incorrectly.", "grade": 9},
            "G9-TRI-7.2-01": {"competency": "Can explain the concept of congruence and identify congruent figures in real-world contexts", "chapter": "Triangles", "subsection": "Congruence Concept", "misconception": "1. Students think congruent means identical position.  \r\n2. Students confuse with similarity.  \r\n3. Students check only shape or only size.", "grade": 9},
            "G9-TRI-7.2-02": {"competency": "Can establish and verify correspondence between vertices of congruent triangles", "chapter": "Triangles", "subsection": "Correspondence", "misconception": "1. Students match vertices randomly.  \r\n2. Students ignore given correspondence.  \r\n3. Students think any matching works.", "grade": 9},
            "G9-TRI-7.2-03": {"competency": "Can apply the concept of CPCT (Corresponding Parts of Congruent Triangles)", "chapter": "Triangles", "subsection": "CPCT", "misconception": "1. Students use CPCT before proving congruence.  \r\n2. Students apply to non-corresponding parts.  \r\n3. Students think CPCT proves congruence.", "grade": 9},
            "G9-TRI-7.3-02": {"competency": "Can apply SAS (Side-Angle-Side) congruence criterion correctly including identifying the included angle", "chapter": "Triangles", "subsection": "SAS Criterion", "misconception": "1. Students use non-included angle.  \r\n2. Students think any angle works.  \r\n3. Students confuse with ASS.", "grade": 9},
            "G9-TRI-7.3-03": {"competency": "Can distinguish between valid SAS and invalid SSA or ASS configurations", "chapter": "Triangles", "subsection": "Valid vs Invalid Criteria", "misconception": "1. Students think SSA always works.  \r\n2. Students don't see ambiguous case.  \r\n3. Students use SSA as valid criterion.", "grade": 9},
            "G9-TRI-7.3-04": {"competency": "Can apply ASA (Angle-Side-Angle) congruence criterion and prove it using SAS", "chapter": "Triangles", "subsection": "ASA Criterion", "misconception": "1. Students use non-included side.  \r\n2. Students confuse with AAS.  \r\n3. Students can't prove using SAS.", "grade": 9},
            "G9-TRI-7.3-05": {"competency": "Can apply AAS (Angle-Angle-Side) congruence criterion understanding angle sum property", "chapter": "Triangles", "subsection": "AAS Criterion", "misconception": "1. Students think need all three angles.  \r\n2. Students confuse with ASA.  \r\n3. Students don't use angle sum.", "grade": 9},
            "G9-TRI-7.3-06": {"competency": "Can explain why AAA (three equal angles) is insufficient for congruence", "chapter": "Triangles", "subsection": "AAA Insufficiency", "misconception": "1. Students think AAA proves congruence.  \r\n2. Students confuse with similarity.  \r\n3. Students don't understand counterexamples.", "grade": 9},
            "G9-TRI-7.3-07": {"competency": "Can construct logical proofs for triangle congruence using given information", "chapter": "Triangles", "subsection": "Congruence Proofs", "misconception": "1. Students state criterion without showing.  \r\n2. Students use wrong criterion.  \r\n3. Students assume what to prove.", "grade": 9},
            "G9-TRI-7.4-02": {"competency": "Can prove and apply the isosceles triangle theorem (equal sides imply equal opposite angles)", "chapter": "Triangles", "subsection": "Isosceles Triangle Theorem", "misconception": "1. Students confuse which angles are equal.  \r\n2. Students think all angles equal.  \r\n3. Students apply to non-isosceles.", "grade": 9},
            "G9-TRI-7.4-03": {"competency": "Can prove and apply the converse of isosceles triangle theorem", "chapter": "Triangles", "subsection": "Converse Theorem", "misconception": "1. Students don't understand converse.  \r\n2. Students think any equal angles work.  \r\n3. Students confuse with original theorem.", "grade": 9},
            "G9-TRI-7.4-04": {"competency": "Can solve problems involving properties of isosceles triangles in complex figures", "chapter": "Triangles", "subsection": "Isosceles Problems", "misconception": "1. Students miss isosceles triangles in figure.  \r\n2. Students use wrong properties.  \r\n3. Students make calculation errors.", "grade": 9},
            "G9-TRI-7.5-01": {"competency": "Can apply SSS (Side-Side-Side) congruence criterion correctly", "chapter": "Triangles", "subsection": "SSS Criterion", "misconception": "1. Students match sides incorrectly.  \r\n2. Students use only two sides.  \r\n3. Students confuse with SAS.", "grade": 9},
            "G9-TRI-7.5-02": {"competency": "Can apply RHS (Right angle-Hypotenuse-Side) congruence criterion for right triangles", "chapter": "Triangles", "subsection": "RHS Criterion", "misconception": "1. Students use for non-right triangles.  \r\n2. Students forget right angle condition.  \r\n3. Students use wrong sides.", "grade": 9},
            "G9-TRI-7.5-03": {"competency": "Can determine which congruence criterion to apply in different problem contexts", "chapter": "Triangles", "subsection": "Choosing Criteria", "misconception": "1. Students always use same criterion.  \r\n2. Students don't analyze given info.  \r\n3. Students force inappropriate criteria.", "grade": 9},
            "G9-TRI-7.5-04": {"competency": "Can prove geometric relationships using congruent triangles (parallel lines, perpendicular bisectors)", "chapter": "Triangles", "subsection": "Using Congruence", "misconception": "1. Students don't identify triangles to use.  \r\n2. Students skip congruence proof.  \r\n3. Students don't apply CPCT correctly.", "grade": 9},
            "G9-TRI-7.6-01": {"competency": "Can synthesize and apply all congruence criteria appropriately in complex problems", "chapter": "Triangles", "subsection": "Synthesis", "misconception": "1. Students get confused between criteria.  \r\n2. Students don't see multiple approaches.  \r\n3. Students make logical errors.", "grade": 9}
        };

// Quiz database - ADD YOUR QUIZ DATA HERE
const quizDatabase = {
  "G10-TRI-6.1-01": {
    "name": "Can differentiate between congruent and similar figures",
    "questions": [
      {
        "id": "MG10C6Q001",
        "text": "Which of the following statements about congruent and similar figures is TRUE?",
        "context": "",
        "choices": [
          {
            "text": "All congruent figures are similar, but not all similar figures are congruent",
            "explanation": "Correct - Congruent figures have the same shape and size, so they are always similar. But similar figures can be of different sizes, so they are not always congruent.",
            "isRight": true
          },
          {
            "text": "All similar figures are congruent, but not all congruent figures are similar",
            "explanation": "Incorrect - This reverses the relationship.",
            "isRight": false
          },
          {
            "text": "Congruent figures and similar figures are exactly the same thing",
            "explanation": "Incorrect - This equates two different concepts.",
            "isRight": false
          },
          {
            "text": "Two figures are similar only if they are exactly the same size",
            "explanation": "Incorrect - Similar figures only need same shape, not same size",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q002",
        "text": "Which statement is correct about these triangles?",
        "context": "Two triangles ABC and PQR have ∠A = ∠P = 60°, ∠B = ∠Q = 50°, and ∠C = ∠R = 70°. Additionally, AB = PQ = 5 cm.",
        "choices": [
          {
            "text": "The triangles are definitely congruent",
            "explanation": "Incorrect - We know all angles are equal and one side is equal, but that is not enough to prove congruence.",
            "isRight": false
          },
          {
            "text": "The triangles are similar but may or may not be congruent",
            "explanation": "Correct – Equal corresponding angles make the triangles similar (AAA), but one equal side is not enough to prove congruence.",
            "isRight": true
          },
          {
            "text": "The triangles are neither similar nor congruent",
            "explanation": "Incorrect – Since all angles are equal, the triangles are always similar but not congruent.",
            "isRight": false
          },
          {
            "text": "The triangles must have all corresponding sides equal",
            "explanation": "Incorrect - This is an unwarranted assumption. Only one side is given equal, so we cannot say all sides are equal.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q003",
        "text": "Which student's figure is NOT similar to the given square?",
        "context": "In a geometry class, students were asked to draw figures similar to a given square ABCD with side 4 cm.",
        "choices": [
          {
            "text": "Priya – rectangle with sides 8 cm and 8 cm",
            "explanation": "Incorrect – This figure is actually a square (8 cm × 8 cm). All squares have the same shape (right angles, equal adjacent sides) so they are similar to each other.",
            "isRight": false
          },
          {
            "text": "Rahul – square with side 2 cm",
            "explanation": "Incorrect – All squares are similar regardless of size (same angles and side-ratio 1:1), so Rahul's square is similar to the given square.",
            "isRight": false
          },
          {
            "text": "Amit – square with side 6 cm rotated 45°",
            "explanation": "Incorrect – Rotation does not change shape or side ratios; a rotated square is still a square and therefore similar.",
            "isRight": false
          },
          {
            "text": "Sara – rectangle with sides 6 cm and 8 cm",
            "explanation": "Correct – A square has side-ratio 1:1. Sara's rectangle has side-ratio 6:8 = 3:4, not 1:1, so it is not similar to a square.",
            "isRight": true
          }
        ]
      }
    ]
  },
  "G10-TRI-6.2-01": {
    "name": "Can identify similar figures and explain why they are similar",
    "questions": [
      {
        "id": "MG10C6Q004",
        "text": "Which of the following pairs of figures are ALWAYS similar?",
        "context": "",
        "choices": [
          {
            "text": "Any two rectangles",
            "explanation": "Incorrect - Rectangles can have different length:width ratios",
            "isRight": false
          },
          {
            "text": "Any two squares",
            "explanation": "Correct - All squares have 90° angles and equal sides, satisfying similarity conditions",
            "isRight": true
          },
          {
            "text": "Any two triangles",
            "explanation": "Incorrect - Triangles are similar only if their corresponding angles are equal or sides are in the same ratio (AAA, SSS, SAS similarity). Not all triangles meet this condition.",
            "isRight": false
          },
          {
            "text": "Any two rhombuses",
            "explanation": "Incorrect – Rhombuses have equal sides, but their angles may differ. Therefore, they are not always similar.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q005",
        "text": "Are these photographs similar? Choose the correct reasoning.",
        "context": "Two photographs of the same building are printed. Photo A is 6 cm × 9 cm and Photo B is 8 cm × 12 cm.",
        "choices": [
          {
            "text": "Yes, because both are rectangles showing the same building",
            "explanation": "Incorrect – What the picture shows (content) does not decide mathematical similarity. Similarity is about shape (angles) and proportional sides, not the subject of the photo.",
            "isRight": false
          },
          {
            "text": "No, because 6 ≠ 8 and 9 ≠ 12",
            "explanation": "Incorrect – Similarity does not require corresponding sides to be equal; it requires them to be in the same ratio (proportional).",
            "isRight": false
          },
          {
            "text": "Yes, because 6/8 = 9/12 = 3/4, maintaining the same ratio",
            "explanation": "Correct - Corresponding sides are proportional: 6/8 = 9/12 = 3/4. Thus the scale factor between Photo A and Photo B is 3/4, so the rectangles are similar.",
            "isRight": true
          },
          {
            "text": "No, because they face different directions",
            "explanation": "Incorrect - Orientation (rotation or which way the photo faces) does not affect similarity. Only angles and side ratios matter.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q006",
        "text": "Who is correct and why?",
        "context": "A student claims: 'All regular polygons with the same number of sides are similar.' Another student disagrees.",
        "choices": [
          {
            "text": "The first student is correct because regular polygons have equal sides",
            "explanation": "Incorrect – Equal sides alone are not enough. We must also consider that regular polygons have equal angles, and side ratios remain the same when scaled.",
            "isRight": false
          },
          {
            "text": "The second student is correct because the polygons might be different sizes",
            "explanation": "Incorrect – Different sizes do not prevent similarity. Similarity depends on shape and side ratios, not actual size.",
            "isRight": false
          },
          {
            "text": "The first student is correct because all angles and side ratios are maintained",
            "explanation": "Correct – In regular n-gons, all interior angles are equal and the side lengths are in the same ratio when compared. Therefore, any two regular polygons with the same number of sides are always similar.",
            "isRight": true
          },
          {
            "text": "The second student is correct because polygons must be congruent to be similar",
            "explanation": "Incorrect – Similarity does not require polygons to be congruent. They may differ in size but still be similar if shape and angle conditions hold.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.2-02": {
    "name": "Can determine if two polygons are similar by verifying corresponding angles are equal and corresponding sides are proportional",
    "questions": [
      {
        "id": "MG10C6Q007",
        "text": "To prove that two polygons are similar, which of the following must be true?",
        "context": "",
        "choices": [
          {
            "text": "Only corresponding angles must be equal",
            "explanation": "Incorrect – Equal angles alone are not enough; side lengths must also be in proportion.",
            "isRight": false
          },
          {
            "text": "Only corresponding sides must be proportional",
            "explanation": "Incorrect – Equal side ratios alone are not enough; angles must also match.",
            "isRight": false
          },
          {
            "text": "Either angles are equal OR sides are proportional",
            "explanation": "Incorrect – Both conditions together are needed; one condition alone does not guarantee similarity.",
            "isRight": false
          },
          {
            "text": "Both corresponding angles are equal AND corresponding sides are proportional",
            "explanation": "Correct – This is the definition of similar polygons.",
            "isRight": true
          }
        ]
      },
      {
        "id": "MG10C6Q008",
        "text": "What additional information is needed to prove their similarity?",
        "context": "In quadrilaterals ABCD and PQRS, all corresponding angles are equal. AB/PQ = 2/3, BC/QR = 2/3, and CD/RS = 2/3.",
        "choices": [
          {
            "text": "No additional information needed",
            "explanation": "Incorrect – For polygons, we must check all corresponding sides. Only three side ratios are given, so one more is missing.",
            "isRight": false
          },
          {
            "text": "AD/PS = 2/3",
            "explanation": "Correct – To prove similarity, all four side ratios must be the same along with equal angles. The ratio of AD to PS is still needed.",
            "isRight": true
          },
          {
            "text": "The quadrilaterals must be the same type",
            "explanation": "Incorrect – Whether the quadrilaterals are trapeziums, parallelograms, or other types doesn't matter. What matters is equal angles and proportional sides.",
            "isRight": false
          },
          {
            "text": "The diagonals must be proportional",
            "explanation": "Incorrect – Diagonals are not part of the similarity condition for polygons. Only sides and angles are considered.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q009",
        "text": "Based on this information, what can be concluded about the similarity of pentagons ABCDE and PQRST?",
        "context": "Two pentagons ABCDE and PQRST are given. A student compares the ratios of their corresponding sides: AB/PQ = 3/5, BC/QR = 3/5, CD/RS = 4/5, DE/ST = 3/5, EA/TP = 3/5.",
        "choices": [
          {
            "text": "The pentagons are similar because most ratios are equal",
            "explanation": "Incorrect - ALL ratios must be equal for similarity",
            "isRight": false
          },
          {
            "text": "The pentagons are not similar because one ratio is different",
            "explanation": "Correct - CD/RS = 4/5 while others = 3/5. Since side ratios are not consistent, the pentagons are not similar.",
            "isRight": true
          },
          {
            "text": "The angles must also be checked before concluding",
            "explanation": "Incorrect – Unequal side ratios already disprove similarity, regardless of angles.",
            "isRight": false
          },
          {
            "text": "The pentagons are similar if they're regular pentagons",
            "explanation": "Incorrect – Even regular pentagons must have equal ratios of corresponding sides. With one ratio different, similarity is not possible.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q010",
        "text": "A student claims that the hexagons are similar. Is this correct?",
        "context": "Two hexagons are given. All their corresponding angles are equal. The ratios of their corresponding sides are: 3/4, 6/8, 9/12, 12/16, 15/20, and 18/24.",
        "choices": [
          {
            "text": "No, because the ratios look different",
            "explanation": "Incorrect – The ratios look different at first, but they all simplify to the same value. We must simplify before concluding.",
            "isRight": false
          },
          {
            "text": "Yes, because all ratios simplify to 3/4",
            "explanation": "Correct - All fractions equal 3/4 when simplified",
            "isRight": true
          },
          {
            "text": "No, because we haven't checked if angles are actually equal",
            "explanation": "Incorrect – The problem already states that all corresponding angles are equal, so this check is unnecessary.",
            "isRight": false
          },
          {
            "text": "Yes, because having equal angles is sufficient",
            "explanation": "Incorrect – Equal angles alone are not enough; side ratios must also be equal. Here, both conditions are satisfied, so that's why similarity holds.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.2-03": {
    "name": "Can calculate scale factor and use it to find unknown measurements in similar figures",
    "questions": [
      {
        "id": "MG10C6Q011",
        "text": "What is the length of PQ?",
        "context": "Triangle ABC is similar to triangle PQR with scale factor of 3/2, and AB = 6 cm.",
        "choices": [
          {
            "text": "9 cm",
            "explanation": "This treats scale factor 3/2 as multiplication directly (6 × 3/2 = 9), but here the ratio given is AB/PQ=3/2, so we must solve carefully.",
            "isRight": false
          },
          {
            "text": "4 cm",
            "explanation": "Correct - PQ = 6 ÷ (3/2) = 6 × 2/3 = 4 cm",
            "isRight": true
          },
          {
            "text": "18 cm",
            "explanation": "Incorrect – This wrongly multiplies 6 × 3 instead of applying the correct ratio.",
            "isRight": false
          },
          {
            "text": "2 cm",
            "explanation": "Incorrect – This wrongly divides 6 ÷ 3, ignoring the actual ratio of 3:2.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q012",
        "text": "What is the ratio of their corresponding sides?",
        "context": "Two similar pentagons have areas 36 cm² and 64 cm².",
        "choices": [
          {
            "text": "9:16",
            "explanation": "Incorrect – This is the ratio of the areas, not the sides.",
            "isRight": false
          },
          {
            "text": "3:4",
            "explanation": "Correct: √(36/64) = 6/8 = 3/4",
            "isRight": true
          },
          {
            "text": "4:9",
            "explanation": "Incorrect – This is the inverse of the correct ratio, a common mistake when simplifying.",
            "isRight": false
          },
          {
            "text": "36:64",
            "explanation": "Incorrect – This is the unsimplified area ratio, not the side ratio.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q013",
        "text": "What is the length of PQ?",
        "context": "Rectangle ABCD ~ Rectangle PQRS. If AB = 12 cm, BC = 8 cm, and the perimeter of PQRS is 30 cm.",
        "choices": [
          {
            "text": "18 cm",
            "explanation": "Incorrect - Uses wrong scale factor",
            "isRight": false
          },
          {
            "text": "9 cm",
            "explanation": "Correct - Perimeter ABCD = 40, scale = 30/40 = 3/4, PQ = 12 × 3/4 = 9",
            "isRight": true
          },
          {
            "text": "6 cm",
            "explanation": "Incorrect – Divides by 2 instead of applying the correct ratio.",
            "isRight": false
          },
          {
            "text": "15 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q014",
        "text": "What is the perimeter of △XYZ?",
        "context": "△PQR∼△XYZ. The sides of △PQR are 5 cm, 12 cm, and 13 cm. The longest side of △XYZ is 26 cm.",
        "choices": [
          {
            "text": "50 cm",
            "explanation": "Incorrect-Divided instead of multiplying by the scale factor (treating 26 ÷ 13 instead of scaling all sides).",
            "isRight": false
          },
          {
            "text": "60 cm",
            "explanation": "Incorrect-Added or scaled incorrectly; perimeter of smaller triangle was not multiplied by correct scale factor.",
            "isRight": false
          },
          {
            "text": "70 cm",
            "explanation": "Correct- Scale factor = 26/13=2 Perimeter of △PQR=5+12+13=30. Perimeter of △XYZ=30×2=70cm.",
            "isRight": true
          },
          {
            "text": "80 cm",
            "explanation": "Incorrect-Multiplied only some sides by 2 or miscalculated addition.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.3-01": {
    "name": "Can apply the Basic Proportionality Theorem (Thales Theorem) to solve problems",
    "questions": [
      {
        "id": "MG10C6Q015",
        "text": "What is the value of AE/EC?",
        "context": "In triangle ABC, DE is parallel to BC. If AD = 3 cm and DB = 2 cm.",
        "choices": [
          {
            "text": "3/2",
            "explanation": "Correct - By Basic Proportionality Theorem, AD/DB = AE/EC = 3/2",
            "isRight": true
          },
          {
            "text": "2/3",
            "explanation": "Incorrect - Inverted the ratio",
            "isRight": false
          },
          {
            "text": "5/3",
            "explanation": "Incorrect - Used sum instead of ratio",
            "isRight": false
          },
          {
            "text": "3/5",
            "explanation": "Incorrect - Wrong fraction combination",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q016",
        "text": "Find TR.",
        "context": "In triangle PQR, ST || QR where S is on PQ and T is on PR. If PS = 4 cm, SQ = 6 cm, and PT = 6 cm.",
        "choices": [
          {
            "text": "4 cm",
            "explanation": "Incorrect – Assumes the segments are equal without applying the Basic Proportionality Theorem.",
            "isRight": false
          },
          {
            "text": "9 cm",
            "explanation": "Correct - PS/SQ = PT/TR gives 4/6 = 6/TR, so TR = 9 cm",
            "isRight": true
          },
          {
            "text": "8 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "10 cm",
            "explanation": "Incorrect – Took sum of lengths (6+4) instead of using the proportional relation.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q017",
        "text": "Find AE.",
        "context": "In triangle ABC, D and E are points on AB and AC respectively such that DE || BC. If AD:DB = 3:5, and AC = 16 cm.",
        "choices": [
          {
            "text": "6 cm",
            "explanation": "Correct - AE/AC = 3/(3+5) = 3/8, so AE = 16 × 3/8 = 6 cm",
            "isRight": true
          },
          {
            "text": "10 cm",
            "explanation": "Incorrect - Used 5/8 instead of 3/8",
            "isRight": false
          },
          {
            "text": "9.6 cm",
            "explanation": "Incorrect - Used 3/5 instead of 3/8",
            "isRight": false
          },
          {
            "text": "8 cm",
            "explanation": "Assumed AE= 1/2 (AC), wrongly dividing side into halves.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q018",
        "text": "Find QS.",
        "context": "In triangle XYZ, two lines PQ and RS are drawn parallel to YZ, where P,R are on XY and Q,S are on XZ. If XP = 2 cm, PR = 3 cm, RY = 4 cm, and XQ = 3 cm.",
        "choices": [
          {
            "text": "4.5 cm",
            "explanation": "Correct - Using proportions systematically: XZ = 13.5 cm, XS = 7.5 cm, QS = 4.5 cm",
            "isRight": true
          },
          {
            "text": "4 cm",
            "explanation": "Incorrect – Arithmetic error; does not follow the proportional divisions along XY and XZ.",
            "isRight": false
          },
          {
            "text": "6 cm",
            "explanation": "Incorrect - Wrong approach",
            "isRight": false
          },
          {
            "text": "5 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q019",
        "text": "A student claims: \"Then E must be the midpoint of AC, and DE=1/2 of BC.\" Is the claim always true?",
        "context": "In △ABC, point D is the midpoint of AB. A line DE is drawn parallel to BC.",
        "choices": [
          {
            "text": "Yes, because D is the midpoint of AB",
            "explanation": "Incorrect – Being midpoint of AB alone is not enough; the key is also DE∥BC. Reasoning incomplete.",
            "isRight": false
          },
          {
            "text": "No, because DE could be anywhere",
            "explanation": "Incorrect – DE cannot be drawn anywhere; it must follow the condition DE∥BC.",
            "isRight": false
          },
          {
            "text": "Yes, because of the midpoint theorem",
            "explanation": "Correct - When D is midpoint and DE || BC, E must be midpoint of AC, giving DE = BC/2",
            "isRight": true
          },
          {
            "text": "No, because we need more information",
            "explanation": "Incorrect - The given conditions are sufficient",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.3-03": {
    "name": "Can prove and apply the converse of Basic Proportionality Theorem",
    "questions": [
      {
        "id": "MG10C6Q020",
        "text": "Which of the following can be concluded here?",
        "context": "In triangle ABC, D is on AB and E is on AC. If AD/DB = AE/EC.",
        "choices": [
          {
            "text": "DE is perpendicular to BC",
            "explanation": "Incorrect - Confuses parallel with perpendicular",
            "isRight": false
          },
          {
            "text": "DE is parallel to BC",
            "explanation": "Correct - This is the converse of Basic Proportionality Theorem",
            "isRight": true
          },
          {
            "text": "DE bisects angle A",
            "explanation": "Incorrect – The condition given has nothing to do with angle bisectors.",
            "isRight": false
          },
          {
            "text": "DE = BC/2",
            "explanation": "Incorrect – The ratio given does not say anything about the exact length of DE; it only shows the lines are parallel.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q021",
        "text": "What is the relationship between ST and QR?",
        "context": "In triangle PQR, S divides PQ in ratio 2:3 and T divides PR in ratio 2:3.",
        "choices": [
          {
            "text": "ST || QR and ST = 2/5 × QR",
            "explanation": "Correct - Since S and T divide the sides in the same ratio (2:3), ST is parallel to QR by BPT. From similarity, ST/QR=2/5, ST=2/5 (QR)",
            "isRight": true
          },
          {
            "text": "ST || QR and ST = 3/5 × QR",
            "explanation": "Incorrect - Wrong fraction for length",
            "isRight": false
          },
          {
            "text": "ST = QR",
            "explanation": "Incorrect – Equal division ratios make the line parallel, but it doesn't mean the lengths are equal.",
            "isRight": false
          },
          {
            "text": "ST is not parallel to QR",
            "explanation": "Incorrect – When points divide two sides of a triangle in the same ratio, the line joining them is always parallel to the third side. So ST must be parallel to QR.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q022",
        "text": "What can we conclude about quadrilateral PQRS?",
        "context": "In quadrilateral ABCD, P divides AB in ratio 1:2, Q divides BC in ratio 1:2, R divides CD in ratio 1:2, and S divides DA in ratio 1:2.",
        "choices": [
          {
            "text": "PQRS is similar to ABCD with scale factor 1/3",
            "explanation": "Incorrect – Dividing sides in a 1:2 ratio does not guarantee similarity to the original quadrilateral. Similarity happens only in special cases, like when ABCD is a square.",
            "isRight": false
          },
          {
            "text": "PQRS is a parallelogram",
            "explanation": "Correct - Applying converse BPT repeatedly shows PQ || SR and PS || QR",
            "isRight": true
          },
          {
            "text": "PQRS is similar to ABCD with scale factor 2/3",
            "explanation": "Incorrect - similarity does not always follow just because sides are divided in proportion.",
            "isRight": false
          },
          {
            "text": "Nothing specific can be concluded",
            "explanation": "Incorrect – Something specific can be said: PQRS will always be a parallelogram.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.3-04": {
    "name": "Can use properties of similar triangles to solve complex problems involving multiple triangles",
    "questions": [
      {
        "id": "MG10C6Q023",
        "text": "Find AD.",
        "context": "In triangle ABC, DE || BC where D is on AB and E is on AC. If DE = 6 cm, BC = 9 cm, and AB = 12 cm.",
        "choices": [
          {
            "text": "8 cm",
            "explanation": "Correct - DE/BC = AD/AB gives 6/9 = AD/12, so AD = 8 cm",
            "isRight": true
          },
          {
            "text": "4 cm",
            "explanation": "Incorrect - Used 1/3 instead of 2/3",
            "isRight": false
          },
          {
            "text": "6 cm",
            "explanation": "Incorrect - Assumes AD = DE",
            "isRight": false
          },
          {
            "text": "9 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q024",
        "text": "Find OC.",
        "context": "In trapezium ABCD with AB || DC, diagonals AC and BD intersect at O. If AB = 6 cm, DC = 4 cm, and AO = 9 cm.",
        "choices": [
          {
            "text": "6 cm",
            "explanation": "Correct - Triangles AOB ~ COD, so AO/OC = AB/DC = 6/4, giving OC = 6 cm",
            "isRight": true
          },
          {
            "text": "4 cm",
            "explanation": "Incorrect - Assumes OC = DC",
            "isRight": false
          },
          {
            "text": "3 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "12 cm",
            "explanation": "This uses the inverted ratio (AO/OC = DC/AB), which is wrong here. The correct ratio gives a smaller OC (6 cm), not a larger one.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q025",
        "text": "A student calculated QR = 9 cm. Is this correct?",
        "context": "Three parallel lines l₁, l₂, and l₃ intersect two transversals. On one transversal they cut the points A, B, C in that order so that AB = 4 cm, BC = 6 cm. On the other transversal they cut the points P, Q, R in that order so that PQ = 6 cm.",
        "choices": [
          {
            "text": "Yes, using the property of parallel lines cutting transversals",
            "explanation": "Correct - AB/BC = PQ/QR gives 4/6 = 6/QR, so QR = 9 cm",
            "isRight": true
          },
          {
            "text": "No, QR should be 8 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "No, QR should be 4 cm",
            "explanation": "Incorrect - Wrong approach",
            "isRight": false
          },
          {
            "text": "Cannot determine without knowing the angle between the transversals.",
            "explanation": "Incorrect – Angles are not needed here. Parallel lines ensure proportional segments on any pair of transversals, regardless of the angle.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q026",
        "text": "Find the length of EC.",
        "context": "In△ABC, DE∥BC where D is on AB and E is on AC. It is given that AD= 4 cm, DB=6 cm, AE=5 cm",
        "choices": [
          {
            "text": "7.5 cm",
            "explanation": "Correct - By BPT Theorem: EC=7.5 cm",
            "isRight": true
          },
          {
            "text": "6.5 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "8 cm",
            "explanation": "Incorrect – Rounded or estimated without exact calculation.",
            "isRight": false
          },
          {
            "text": "9 cm",
            "explanation": "Incorrect – Wrong substitution (took AD/AB instead of AD/DB).",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.4-01": {
    "name": "Can apply AAA (or AA) similarity criterion to prove triangles are similar",
    "questions": [
      {
        "id": "MG10C6Q027",
        "text": "What can we conclude?",
        "context": "In triangles ABC and PQR, if ∠A = ∠P and ∠B = ∠Q.",
        "choices": [
          {
            "text": "The triangles are congruent",
            "explanation": "Incorrect - Equal angles don't guarantee congruence",
            "isRight": false
          },
          {
            "text": "The triangles are similar",
            "explanation": "Correct - By AA similarity criterion, two equal angles guarantee similarity",
            "isRight": true
          },
          {
            "text": "We need to check the third angle",
            "explanation": "Incorrect - Third angle is automatically equal (sum = 180°)",
            "isRight": false
          },
          {
            "text": "We need to check if sides are proportional",
            "explanation": "Incorrect - AA criterion doesn't require side information",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q028",
        "text": "Are these triangles similar?",
        "context": "In triangle ABC, ∠A = 50°, ∠B = 60°. In triangle DEF, ∠E = 60°, ∠F = 70°.",
        "choices": [
          {
            "text": "Yes, because both have a 60° angle",
            "explanation": "Incorrect – Just one equal angle is not enough. We need at least two equal pairs of angles for AA similarity.",
            "isRight": false
          },
          {
            "text": "No, because the angles don't match properly",
            "explanation": "Incorrect - They do match when properly analyzed",
            "isRight": false
          },
          {
            "text": "Yes, because ∠A = ∠D = 50°, ∠B = ∠E = 60°",
            "explanation": "Correct – By AA criterion, two equal pairs of angles are enough to prove similarity. The third pair (70°) is automatically equal.",
            "isRight": true
          },
          {
            "text": "Cannot determine without side lengths",
            "explanation": "Incorrect – Side lengths are not needed here. By AA criterion, angles alone are sufficient.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q029",
        "text": "Based on the given information, which of the following can be concluded here?",
        "context": "In triangles ABC and DEF, angles are related as: ∠A + ∠D = 90°, ∠B + ∠E = 90°, and ∠C + ∠F = 90°.",
        "choices": [
          {
            "text": "The triangles are similar",
            "explanation": "Incorrect – The angles given are complementary across two triangles, not equal within the same triangle. Similarity requires equal corresponding angles, not complementary ones.",
            "isRight": false
          },
          {
            "text": "The triangles are congruent",
            "explanation": "Incorrect – No information about equal sides or equal corresponding angles is given, so congruence cannot be claimed.",
            "isRight": false
          },
          {
            "text": "Neither congruency nor similarity of triangles can be concluded",
            "explanation": "Correct – Complementary angle sums across two triangles do not prove similarity or congruence. No special relation follows from the given conditions.",
            "isRight": true
          },
          {
            "text": "One triangle has all acute angles, other has all obtuse angles",
            "explanation": "Incorrect – This is impossible since the sum of angles in a triangle is 180°. A triangle cannot have all angles obtuse.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q030",
        "text": "The teacher says the proof is incomplete. Why?",
        "context": "A student proves two triangles similar by showing their angles are 40°, 60°, 80° and 40°, 80°, 60° respectively.",
        "choices": [
          {
            "text": "The angles must be listed in the same order",
            "explanation": "Incorrect – The order in which the student lists the angles doesn't matter as long as the correct correspondence is shown.",
            "isRight": false
          },
          {
            "text": "The student should verify angles sum to 180°",
            "explanation": "Incorrect – This is always true for any triangle, so no extra check is needed.",
            "isRight": false
          },
          {
            "text": "The student must specify which angles correspond",
            "explanation": "Correct – To prove similarity, the student must clearly show which vertex in one triangle matches with which vertex in the other. Without correspondence, the proof is incomplete.",
            "isRight": true
          },
          {
            "text": "All of the above",
            "explanation": "Incorrect – Only the correspondence of angles is necessary. The other reasons are not valid.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.4-02": {
    "name": "Can apply SSS similarity criterion to prove triangles are similar",
    "questions": [
      {
        "id": "MG10C6Q031",
        "text": "Which condition must be satisfied for △ABC∼△PQR?",
        "context": "For triangles ABC and PQR to be similar by SSS criterion",
        "choices": [
          {
            "text": "AB = PQ, BC = QR, CA = RP",
            "explanation": "Incorrect - This describes congruence, not similarity",
            "isRight": false
          },
          {
            "text": "AB/PQ = BC/QR = CA/RP",
            "explanation": "Correct – For two triangles to be similar by the SSS similarity criterion, the corresponding sides must be in the same ratio.",
            "isRight": true
          },
          {
            "text": "AB + BC + CA = PQ + QR + RP",
            "explanation": "Incorrect – Equal perimeters don't prove similarity. Two very different triangles can have the same perimeter.",
            "isRight": false
          },
          {
            "text": "AB × BC × CA = PQ × QR × RP",
            "explanation": "Incorrect – Equal products of side lengths don't show similarity; side ratios must match.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q032",
        "text": "Are they similar?",
        "context": "Triangle ABC has sides 6 cm, 8 cm, 10 cm. Triangle PQR has sides 9 cm, 12 cm, 15 cm.",
        "choices": [
          {
            "text": "No, because 6 ≠ 9, 8 ≠ 12, 10 ≠ 15",
            "explanation": "Incorrect – Similarity doesn't require equal sides, only proportional sides. This confuses similarity with congruence.",
            "isRight": false
          },
          {
            "text": "Yes, because 6/9 = 8/12 = 10/15 = 2/3",
            "explanation": "Correct – By the SSS similarity criterion, if all corresponding side ratios are equal, the triangles are similar. Here, all ratios equal 2/3.",
            "isRight": true
          },
          {
            "text": "Yes, because both are right triangles",
            "explanation": "Incorrect - Being right triangles isn't sufficient",
            "isRight": false
          },
          {
            "text": "Cannot determine without angles",
            "explanation": "Incorrect - SSS criterion doesn't need angles",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q033",
        "text": "Student 1 claims - \"They're always similar.\" Student 2 claims - \"They're always congruent if k = 1.\" Who is correct?",
        "context": "Triangle ABC has sides a, b, c. Triangle PQR has sides ka, kb, kc where k > 0.",
        "choices": [
          {
            "text": "Only Student 1",
            "explanation": "Incorrect – It is true that the triangles are always similar, but it is also true that they are congruent when k=1. Ignoring the second claim makes this incomplete.",
            "isRight": false
          },
          {
            "text": "Only Student 2",
            "explanation": "Incorrect – It is true that when k=1, the triangles are congruent, but the first claim (always similar) is also correct. Ignoring the first claim makes this incomplete.",
            "isRight": false
          },
          {
            "text": "Both Student 1 and Student 2",
            "explanation": "Correct - Constant ratio k ensures similarity; k=1 gives congruence",
            "isRight": true
          },
          {
            "text": "Neither of them",
            "explanation": "Incorrect - Both made correct statements",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q034",
        "text": "The teacher points out an error. What is it?",
        "context": "A student checks triangle similarity: AB/PQ = 12/18 = 2/3, BC/RS = 16/24 = 2/3, CA/RP = 20/30 = 2/3.",
        "choices": [
          {
            "text": "The ratios should all equal 3/2, not 2/3",
            "explanation": "Incorrect – Ratios can be written either as 2/3 or 3/2, depending on which triangle is taken first. The problem is not the fraction itself.",
            "isRight": false
          },
          {
            "text": "The correspondence BC/RS should be BC/QR",
            "explanation": "Correct – For △ABC∼△PQR, corresponding vertices must match: A↔P, B↔Q, C↔R. That means side BC should be compared with QR, not with RS.",
            "isRight": true
          },
          {
            "text": "The ratios should be checked in reverse order",
            "explanation": "Incorrect – Order of writing ratios doesn't matter as long as correct correspondence of sides is maintained.",
            "isRight": false
          },
          {
            "text": "There is no error",
            "explanation": "Incorrect - There is a correspondence error",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.4-03": {
    "name": "Can apply SAS similarity criterion to prove triangles are similar",
    "questions": [
      {
        "id": "MG10C6Q035",
        "text": "If two triangles are to be checked for similarity using SAS, which condition must hold true?",
        "context": "For SAS similarity criterion",
        "choices": [
          {
            "text": "Two sides proportional and any angle equal",
            "explanation": "Incorrect – The equal angle must lie between the proportional sides. Any other angle will not guarantee similarity.",
            "isRight": false
          },
          {
            "text": "Two sides proportional and the included angle equal",
            "explanation": "Correct – This is exactly the SAS similarity criterion: two pairs of sides in the same ratio and the angle between them equal.",
            "isRight": true
          },
          {
            "text": "Any two sides and any angle",
            "explanation": "Incorrect – This misses the proportionality requirement and angle placement. Not sufficient for similarity.",
            "isRight": false
          },
          {
            "text": "All sides proportional and one angle equal",
            "explanation": "Incorrect-If all sides are proportional, SSS criterion alone is enough; no angle check is required.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q036",
        "text": "Are they similar?",
        "context": "In triangles ABC and DEF, AB = 8 cm, AC = 12 cm, ∠A = 50°, DE = 12 cm, DF = 18 cm, ∠D = 50°.",
        "choices": [
          {
            "text": "No, because sides aren't equal",
            "explanation": "Incorrect - Requires proportional sides, not equal",
            "isRight": false
          },
          {
            "text": "Yes, by SAS similarity since AB/DE = AC/DF = 2/3 and ∠A = ∠D",
            "explanation": "Correct - Proportional sides with included angle equal",
            "isRight": true
          },
          {
            "text": "Yes, because they have equal angles",
            "explanation": "Incorrect – Only one angle is equal. By the AA criterion, two equal pairs of angles are needed.",
            "isRight": false
          },
          {
            "text": "Cannot determine without BC and EF",
            "explanation": "Incorrect – For SAS similarity, knowing the ratios of two sides and the included angle is sufficient. We don't need the third side.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q037",
        "text": "If the two triangles are similar by the SAS criterion, what is the length of QR?",
        "context": "In triangle ABC, AB = 10 cm, BC = 15 cm, ∠B = 60°. In triangle PQR, PQ = 6 cm, ∠Q = 60°. If the triangles are similar by SAS criterion",
        "choices": [
          {
            "text": "9 cm",
            "explanation": "Correct - AB/PQ = BC/QR gives 10/6 = 15/QR, so QR = 9 cm",
            "isRight": true
          },
          {
            "text": "10 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "4 cm",
            "explanation": "Incorrect - Wrong ratio used",
            "isRight": false
          },
          {
            "text": "25 cm",
            "explanation": "Incorrect - Inverted the ratio",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q038",
        "text": "What's wrong with this statement?",
        "context": "A student claims: 'If two triangles have two sides proportional and one angle equal they're always similar.'",
        "choices": [
          {
            "text": "Nothing, it's correct",
            "explanation": "Incorrect - Missing crucial detail about angle position",
            "isRight": false
          },
          {
            "text": "The angle must be between the proportional sides",
            "explanation": "Correct – This is the SAS similarity criterion: two sides in the same ratio and the included angle equal.",
            "isRight": true
          },
          {
            "text": "The triangles must be right triangles",
            "explanation": "Incorrect - SAS works for all triangles",
            "isRight": false
          },
          {
            "text": "All three sides must be proportional",
            "explanation": "Incorrect – That would be the SSS criterion. For SAS, only two sides and the included angle are needed.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.4-04": {
    "name": "Can determine which similarity criterion to use in a given problem",
    "questions": [
      {
        "id": "MG10C6Q039",
        "text": "When all three sides of both triangles are known, which similarity criterion is best to check their similarity?",
        "context": "",
        "choices": [
          {
            "text": "AA criterion",
            "explanation": "Incorrect – To use AA, you would first need to calculate the angles from the side lengths.",
            "isRight": false
          },
          {
            "text": "SSS criterion",
            "explanation": "Correct – Since all side lengths are already given, directly checking whether the three pairs of sides are in the same ratio is the most efficient",
            "isRight": true
          },
          {
            "text": "SAS criterion",
            "explanation": "Incorrect – To apply SAS, you would need to know an included angle, which is not given.",
            "isRight": false
          },
          {
            "text": "Any criterion works equally well",
            "explanation": "Incorrect – Not true here. With all side lengths known, SSS is clearly the easiest and most efficient.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q040",
        "text": "Which approach is best to check similarity?",
        "context": "In a problem, you are given two angles of each triangle and one side of each triangle.",
        "choices": [
          {
            "text": "Use AA criterion, ignore the sides",
            "explanation": "Correct – If two angles of one triangle equal two angles of another, the triangles are similar by AA. The sides are not needed.",
            "isRight": true
          },
          {
            "text": "Use SAS criterion after finding third angle",
            "explanation": "Incorrect – SAS requires two sides and the included angle. Here, side information is not in the right form.",
            "isRight": false
          },
          {
            "text": "Calculate all sides using sine rule, then use SSS",
            "explanation": "Incorrect – This is unnecessarily complicated. Angles alone are enough.",
            "isRight": false
          },
          {
            "text": "Find third angle, match sides, then apply ASA congruence",
            "explanation": "Incorrect – This confuses similarity with congruence. Congruence needs equal sides, not just angles.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q041",
        "text": "Which combination is NOT sufficient to prove similarity?",
        "context": "You need to prove that two triangles are similar. You are allowed to measure any three parts (sides or angles) from each triangle.",
        "choices": [
          {
            "text": "Three angles from each triangle",
            "explanation": "Incorrect - AAA is valid",
            "isRight": false
          },
          {
            "text": "Three sides from each triangle",
            "explanation": "Incorrect - SSS is valid",
            "isRight": false
          },
          {
            "text": "Two sides and the included angle from each triangle",
            "explanation": "Incorrect - SAS is valid",
            "isRight": false
          },
          {
            "text": "Two sides and a non-included angle from each triangle",
            "explanation": "Correct – SSA (side—side—angle) is not a valid similarity criterion.",
            "isRight": true
          }
        ]
      },
      {
        "id": "MG10C6Q042",
        "text": "What additional information is required to prove similarity?",
        "context": "To prove triangles ABC and PQR are similar, a student has: ∠A = 45°, ∠B = 60°, AB = 8 cm, PQ = 12 cm.",
        "choices": [
          {
            "text": "∠P = 45° or ∠Q = 60°",
            "explanation": "Correct – If one more corresponding angle matches, then by the AA similarity criterion the triangles are similar.",
            "isRight": true
          },
          {
            "text": "Measurements of BC and QR",
            "explanation": "Incorrect – Knowing just one pair of corresponding sides is not enough; you'd also need another side pair and an angle to use SAS.",
            "isRight": false
          },
          {
            "text": "Measurements of ∠C and ∠R",
            "explanation": "Incorrect - These are determined by first two angles",
            "isRight": false
          },
          {
            "text": "All remaining angles and sides",
            "explanation": "Incorrect – This is far more than required. Just one more angle correspondence is sufficient.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.4-05": {
    "name": "Can solve real-world problems using triangle similarity",
    "questions": [
      {
        "id": "MG10C6Q043",
        "text": "What is the height of the tree?",
        "context": "A 1.5 m tall person casts a 2 m shadow. At the same time a tree casts an 8 m shadow.",
        "choices": [
          {
            "text": "6 m",
            "explanation": "Correct - 1.5/2 = h/8 gives h = 6 m",
            "isRight": true
          },
          {
            "text": "10.67 m",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "12 m",
            "explanation": "Incorrect - Added instead of using proportion",
            "isRight": false
          },
          {
            "text": "5.33 m",
            "explanation": "Incorrect - Inverted the ratio",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q044",
        "text": "What is the width of the river?",
        "context": "To measure river width, Amit marks point B across from A, walks 50 m to C, then 20 m perpendicular to D. From D, he walks parallel to AC until B, C, E are collinear (30 m).",
        "choices": [
          {
            "text": "75 m",
            "explanation": "Correct - Similar triangles give AB/30 = 50/20, so AB = 75 m",
            "isRight": true
          },
          {
            "text": "83.33 m",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "60 m",
            "explanation": "Incorrect - Wrong ratio used",
            "isRight": false
          },
          {
            "text": "100 m",
            "explanation": "Incorrect - Wrong method",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q045",
        "text": "What is the actual height of the object?",
        "context": "A pinhole camera has image height 2 cm for an object 3 m away. Pinhole to screen distance is 10 cm.",
        "choices": [
          {
            "text": "60 cm",
            "explanation": "Correct - h/300 = 2/10 gives h = 60 cm",
            "isRight": true
          },
          {
            "text": "30 cm",
            "explanation": "Incorrect - Wrong ratio",
            "isRight": false
          },
          {
            "text": "45 cm",
            "explanation": "Incorrect - Calculation error",
            "isRight": false
          },
          {
            "text": "15 cm",
            "explanation": "Incorrect - Wrong units",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q046",
        "text": "What is the height of the tower?",
        "context": "An engineer places a mirror on the ground 40 m from a tower. She stands 2.5 m from the mirror, and her eye level is 1.6 m. She can just see the top of the tower in the mirror.",
        "choices": [
          {
            "text": "25.6 m",
            "explanation": "Correct - 1.6/2.5 = h/40 gives h = 25.6 m",
            "isRight": true
          },
          {
            "text": "64 m",
            "explanation": "Incorrect - Calculation error",
            "isRight": false
          },
          {
            "text": "100 m",
            "explanation": "Incorrect - Wrong method",
            "isRight": false
          },
          {
            "text": "16 m",
            "explanation": "Incorrect - Wrong ratio",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-6.4-06": {
    "name": "Can distinguish between similarity and congruence criteria and apply them correctly",
    "questions": [
      {
        "id": "MG10C6Q047",
        "text": "Which statement correctly compares similarity and congruence criteria?",
        "context": "Congruence and similarity of triangles have some criteria that sound alike but are actually different.",
        "choices": [
          {
            "text": "SAS for congruence is the same as SAS for similarity",
            "explanation": "Incorrect - SAS similarity needs proportional sides, not equal",
            "isRight": false
          },
          {
            "text": "AAA proves congruence while AA proves similarity",
            "explanation": "Incorrect - AAA doesn't prove congruence",
            "isRight": false
          },
          {
            "text": "ASA is a congruence criterion but not a similarity criterion",
            "explanation": "Correct - ASA requires one equal side, not proportional sides",
            "isRight": true
          },
          {
            "text": "RHS works for both congruence and similarity",
            "explanation": "Incorrect-RHS (Right angle—Hypotenuse—Side) is a special congruence criterion, not a similarity criterion.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q048",
        "text": "Which of the following can be concluded based on the given information?",
        "context": "In triangles ABC and PQR: AB = PQ = 5 cm, ∠B = ∠Q = 60°, BC = 7 cm, QR = 7 cm.",
        "choices": [
          {
            "text": "Similar but not congruent",
            "explanation": "Incorrect – The triangles meet the SAS congruence condition (two equal sides with equal included angle). That makes them congruent, not just similar.",
            "isRight": false
          },
          {
            "text": "Congruent and therefore similar",
            "explanation": "Correct – By SAS congruence, the triangles are congruent. Since congruence is a stronger condition, the triangles are also similar",
            "isRight": true
          },
          {
            "text": "Similar by SAS but not necessarily congruent",
            "explanation": "Incorrect – With equal sides and equal angle, congruence is guaranteed, so \"not necessarily\" is wrong.",
            "isRight": false
          },
          {
            "text": "Neither similar nor congruent",
            "explanation": "Incorrect – They clearly meet SAS congruence.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q049",
        "text": "Is this statement true?",
        "context": "A student says: \"RHS similarity criterion exists because if the hypotenuse and one side of a right triangle are proportional to those of another right triangle, then the triangles are similar.\"",
        "choices": [
          {
            "text": "Yes, RHS works for both congruence and similarity",
            "explanation": "Correct - Proportional H and S force third side proportional by Pythagoras",
            "isRight": true
          },
          {
            "text": "No, RHS only works for congruence, not similarity",
            "explanation": "Incorrect – The RHS idea can extend to similarity when proportional sides are used.",
            "isRight": false
          },
          {
            "text": "Yes, but only if the proportionality constant is 1",
            "explanation": "Incorrect – If the ratio is 1, it means the triangles are congruent. For similarity, the ratio can be any positive constant.",
            "isRight": false
          },
          {
            "text": "No, because right triangles are always similar",
            "explanation": "Incorrect – Right triangles are not always similar; their acute angles must match or their sides must be proportional.",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q050",
        "text": "Which additional condition ensures that the two triangles are similar?",
        "context": "Two isosceles triangles have vertex angles 40° each.",
        "choices": [
          {
            "text": "Base angles are 70° each",
            "explanation": "Incorrect - This is already determined",
            "isRight": false
          },
          {
            "text": "They are both acute triangles",
            "explanation": "Incorrect - Already true with 40°, 70°, 70°",
            "isRight": false
          },
          {
            "text": "No additional condition needed",
            "explanation": "Correct - Both have angles 40°, 70°, 70°, so AA criterion satisfied",
            "isRight": true
          },
          {
            "text": "The equal sides are in the same ratio.",
            "explanation": "Incorrect – For similarity, proportional sides are not needed if all angles are already equal.",
            "isRight": false
          }
        ]
      }
    ]
  },
  "G10-TRI-ADV-01": {
    "name": "Can prove properties of similar triangles including ratios of corresponding altitudes and medians",
    "questions": [
      {
        "id": "MG10C6Q051",
        "text": "What is the altitude from P in triangle PQR?",
        "context": "In similar triangles ABC and PQR with similarity ratio 2:3, the altitude from A in triangle ABC is 8 cm.",
        "choices": [
          {
            "text": "12 cm",
            "explanation": "Correct - Altitudes scale with same ratio: 8 × 3/2 = 12 cm",
            "isRight": true
          },
          {
            "text": "5.33 cm",
            "explanation": "Incorrect - Inverted ratio",
            "isRight": false
          },
          {
            "text": "18 cm",
            "explanation": "Incorrect - Wrong calculation",
            "isRight": false
          },
          {
            "text": "16 cm",
            "explanation": "Incorrect - Doubled the length instead of using the ratio",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q052",
        "text": "What is the area of triangle DEF?",
        "context": "Triangle ABC ~ Triangle DEF with scale factor 3:4. The median from vertex B in triangle ABC is 9 cm, and the area of triangle ABC is 54 cm².",
        "choices": [
          {
            "text": "72 cm²",
            "explanation": "Incorrect – Used the linear ratio 3:4 directly for areas, instead of squaring it.",
            "isRight": false
          },
          {
            "text": "96 cm²",
            "explanation": "Correct - Area ratio = (3/4)² = 9/16, so area DEF = 54 × 16/9 = 96 cm²",
            "isRight": true
          },
          {
            "text": "81 cm²",
            "explanation": "Incorrect - Calculation error",
            "isRight": false
          },
          {
            "text": "108 cm²",
            "explanation": "Incorrect - Wrong ratio used",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q053",
        "text": "Which of these calculations is wrong?",
        "context": "In two similar triangles, the ratio of corresponding sides is 2:5. A student makes these calculations: Ratio of perimeters = 2:5, Ratio of altitudes = 2:5, Ratio of areas = 4:25, Ratio of medians = 4:25",
        "choices": [
          {
            "text": "Ratio of perimeters",
            "explanation": "Incorrect - This is correct (linear scaling)",
            "isRight": false
          },
          {
            "text": "Ratio of altitudes",
            "explanation": "Incorrect - This is correct (linear scaling)",
            "isRight": false
          },
          {
            "text": "Ratio of areas",
            "explanation": "Incorrect - This is correct (quadratic scaling)",
            "isRight": false
          },
          {
            "text": "Ratio of medians",
            "explanation": "Correct – Medians are line segments, so they scale linearly, not quadratically. The ratio should be 2:5, not 4:25.",
            "isRight": true
          }
        ]
      }
    ]
  },
  "G10-TRI-ADV-02": {
    "name": "Can apply similarity concepts to prove theorems like Pythagoras theorem",
    "questions": [
      {
        "id": "MG10C6Q054",
        "text": "Which relationship is NOT true?",
        "context": "In a right triangle ABC with right angle at C, CD is the altitude to hypotenuse AB.",
        "choices": [
          {
            "text": "Triangle ACD ~ Triangle CBD ~ Triangle ABC",
            "explanation": "Correct – △ACD∼△ABC and △CBD∼△ABC, but △ACD and △CBD are not similar to each other (they share different acute angles).",
            "isRight": true
          },
          {
            "text": "CD² = AD × DB",
            "explanation": "Incorrect - This is true.",
            "isRight": false
          },
          {
            "text": "AC² = AD × AB",
            "explanation": "Incorrect - This is true by similarity",
            "isRight": false
          },
          {
            "text": "BC² = BD × BA",
            "explanation": "Incorrect - This is true by similarity",
            "isRight": false
          }
        ]
      },
      {
        "id": "MG10C6Q055",
        "text": "Using similar triangles which of these can be proved? I. Pythagoras theorem II. Angle bisector theorem III. Midpoint theorem",
        "context": "",
        "choices": [
          {
            "text": "Only I",
            "explanation": "Incorrect - All three can be proved",
            "isRight": false
          },
          {
            "text": "Only I and II",
            "explanation": "Incorrect - All three can be proved",
            "isRight": false
          },
          {
            "text": "Only I and III",
            "explanation": "Incorrect - All three can be proved",
            "isRight": false
          },
          {
            "text": "All of them",
            "explanation": "Correct - Similarity is a powerful proof technique for all three",
            "isRight": true
          }
        ]
      }
    ]
  }
}

// Quiz state
let activeQuiz = null;
let currentQuestionIndex = 0;
let userAnswer = null;

// Function to launch quiz
function launchQuiz(competencyCode) {
    if (!quizDatabase[competencyCode] || !quizDatabase[competencyCode].questions.length) {
        alert('Quiz not available for this competency yet.');
        return;
    }
    
    activeQuiz = competencyCode;
    currentQuestionIndex = 0;
    userAnswer = null;
    
    const player = document.getElementById('quizPlayer');
    player.classList.add('show');
    
    showQuestion();
}

// Function to close quiz
function closeQuiz() {
    const player = document.getElementById('quizPlayer');
    player.classList.remove('show');
    activeQuiz = null;
}

// Function to show current question
function showQuestion() {
    if (!activeQuiz) return;
    
    const competency = quizDatabase[activeQuiz];
    const question = competency.questions[currentQuestionIndex];
    
    // Update progress
    document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
    document.getElementById('totalQuestions').textContent = competency.questions.length;
    document.getElementById('quizCompetency').textContent = `${activeQuiz} • ${competency.name}`;
    
    // Show stimulus if available
    const stimulusBox = document.getElementById('stimulusBox');
    if (question.context && question.context.trim()) {
        stimulusBox.style.display = 'block';
        document.getElementById('stimulusContent').textContent = question.context;
    } else {
        stimulusBox.style.display = 'none';
    }
    
    // Show question text
    document.getElementById('questionText').textContent = question.text;
    
    // Show options
    const optionsGrid = document.getElementById('optionsGrid');
    optionsGrid.innerHTML = '';
    
    question.choices.forEach((choice, idx) => {
        const optionCard = document.createElement('div');
        optionCard.className = 'option-card';
        optionCard.innerHTML = `
            <div>
                <span class="option-label">${String.fromCharCode(65 + idx)}</span>
                <span>${choice.text}</span>
            </div>
            <div class="rationale-box" id="rationale-${idx}">
                ${choice.explanation}
            </div>
        `;
        optionCard.onclick = () => selectAnswer(idx);
        optionsGrid.appendChild(optionCard);
    });
    
    // Reset state
    userAnswer = null;
    updateNavigation();
}

// Function to handle answer selection
function selectAnswer(index) {
    if (userAnswer !== null) return; // Already answered
    
    userAnswer = index;
    const question = quizDatabase[activeQuiz].questions[currentQuestionIndex];
    const cards = document.querySelectorAll('.option-card');
    
    // Disable all options
    cards.forEach(card => card.classList.add('disabled'));
    
    // Mark selected option
    const selectedCard = cards[index];
    const isCorrect = question.choices[index].isRight;
    
    selectedCard.classList.add(isCorrect ? 'correct' : 'incorrect');
    
    // Show rationale for selected answer
    document.getElementById(`rationale-${index}`).classList.add('show');
    
    // If wrong, also highlight the correct answer
    if (!isCorrect) {
        question.choices.forEach((choice, idx) => {
            if (choice.isRight) {
                cards[idx].classList.add('correct');
                document.getElementById(`rationale-${idx}`).classList.add('show');
            }
        });
    }
    
    updateNavigation();
}

// Function to go to previous question
function prevQuestion() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        showQuestion();
    }
}

// Function to go to next question
function nextQuestion() {
    const competency = quizDatabase[activeQuiz];
    if (currentQuestionIndex < competency.questions.length - 1) {
        currentQuestionIndex++;
        showQuestion();
    } else {
        // Quiz completed
        alert('Quiz completed!');
        closeQuiz();
    }
}

// Function to update navigation buttons
function updateNavigation() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const competency = quizDatabase[activeQuiz];
    
    prevBtn.disabled = currentQuestionIndex === 0;
    
    if (currentQuestionIndex === competency.questions.length - 1) {
        nextBtn.textContent = 'Finish';
    } else {
        nextBtn.textContent = 'Next';
    }
}

        // Chapter groupings for grades 6-9
        const chapterGroups = {
            6: {
                "Lines and Angles": ["G6-LA-2.2-01", "G6-LA-2.5-01", "G6-LA-2.5-02", "G6-LA-2.8-02", "G6-LA-2.8-03", "G6-LA-2.9-02", "G6-LA-2.9-03", "G6-LA-2.10-01", "G6-LA-2.11-04", "G6-LA-2.11-05", "G6-LA-NA-02"],
                "Practical Geometry": ["G6-PC-8.0-02", "G6-PC-8.1-03", "G6-PC-8.3-02"],
                "Symmetry": ["G6-SYM-9.1-02"]
            },
            7: {
                "Pairs of Lines": ["G7-PIL-5.1-02", "G7-PIL-5.3-02", "G7-PIL-5.5-01", "G7-PIL-5.6-01", "G7-PIL-5.6-02", "G7-PIL-5.7-01", "G7-PIL-5.8-01", "G7-PIL-5.8-02", "G7-PIL-NA-01"],
                "A Tale of Three Intersecting Lines": ["G7-TTIL-7.1-02", "G7-TTIL-7.2-02", "G7-TTIL-7.2-03", "G7-TTIL-7.3-01", "G7-TTIL-7.3-04", "G7-TTIL-7.3-05", "G7-TTIL-7.3-06", "G7-TTIL-7.3-07", "G7-TTIL-7.4-01", "G7-TTIL-7.4-02", "G7-TTIL-7.5-01", "G7-TTIL-7.5-02"]
            },
            8: {
                "Understanding Quadrilaterals": ["G8-UQ-3.1-01", "G8-UQ-3.2-01", "G8-UQ-3.2-02", "G8-UQ-3.3-03", "G8-UQ-3.3.4-01"]
            },
            9: {
                "Euclid's Geometry": ["G9-EG-2-03", "G9-EG-2-08", "G9-EG-3-02", "G9-EG-4-02"],
                "Lines and Angles": ["G9-LA-1-01", "G9-LA-2-01", "G9-LA-2-02", "G9-LA-2-03", "G9-LA-6-01", "G9-LA-6-02", "G9-LA-6-03", "G9-LA-7-01", "G9-LA-8-01"],
                "Triangles": ["G9-TRI-7.1-01", "G9-TRI-7.2-01", "G9-TRI-7.2-02", "G9-TRI-7.2-03", "G9-TRI-7.3-02", "G9-TRI-7.3-03", "G9-TRI-7.3-04", "G9-TRI-7.3-05", "G9-TRI-7.3-06", "G9-TRI-7.3-07", "G9-TRI-7.4-02", "G9-TRI-7.4-03", "G9-TRI-7.4-04", "G9-TRI-7.5-01", "G9-TRI-7.5-02", "G9-TRI-7.5-03", "G9-TRI-7.5-04", "G9-TRI-7.6-01"]
            }
        };
        
        // Grade 10 subsection groups
        const g10SubsectionGroups = {
            "Introduction": ["G10-TRI-6.1-01"],
            "Similar Figures": ["G10-TRI-6.2-01", "G10-TRI-6.2-02", "G10-TRI-6.2-03"],
            "Similarity of Triangles": ["G10-TRI-6.3-01", "G10-TRI-6.3-02", "G10-TRI-6.3-03", "G10-TRI-6.3-04"],
            "Criteria for Similarity of Triangles": ["G10-TRI-6.4-01", "G10-TRI-6.4-02", "G10-TRI-6.4-03", "G10-TRI-6.4-04", "G10-TRI-6.4-05", "G10-TRI-6.4-06"],
            "Extended Learning": ["G10-TRI-ADV-01", "G10-TRI-ADV-02"]
        };

        // All competency stations with exact codes and positions
        const stations = [
            // Grade 6 Stations - Lines & Angles
            { code: 'G6-LA-2.2-01', name: 'Can identify a line segment as the shortest path between two points and denote it correctly', grade: 6, x: 70, y: 200 },
            { code: 'G6-LA-2.5-01', name: 'Can identify an angle as formed by two rays with a common starting point (vertex)', grade: 6, x: 70, y: 250 },
            { code: 'G6-LA-2.5-02', name: 'Can understand that the size of an angle depends on the amount of rotation not the length of arms', grade: 6, x: 70, y: 300 },
            { code: 'G6-LA-2.8-02', name: 'Can identify a right angle as exactly half of a straight angle measuring 90°', grade: 6, x: 70, y: 350 },
            { code: 'G6-LA-2.8-03', name: 'Can classify angles as acute right obtuse or straight based on their measures', grade: 6, x: 70, y: 400 },
            { code: 'G6-LA-2.9-02', name: 'Can use a protractor correctly to measure angles', grade: 6, x: 70, y: 450 },
            { code: 'G6-LA-2.9-03', name: 'Can measure angles by aligning one arm with 0° and reading where the other arm points', grade: 6, x: 70, y: 500 },
            { code: 'G6-LA-2.10-01', name: 'Can draw angles of given measures using a protractor', grade: 6, x: 70, y: 550 },
            { code: 'G6-LA-2.11-04', name: 'Can solve problems involving angle relationships in straight lines', grade: 6, x: 70, y: 600 },
            { code: 'G6-LA-2.11-05', name: 'Can identify angles in real-world contexts like clocks doors and swings', grade: 6, x: 70, y: 650 },
            { code: 'G6-LA-NA-02', name: 'Can understand that perpendicular lines meet at right angles', grade: 6, x: 70, y: 700 },
            
            // Grade 6 - Constructions
            { code: 'G6-PC-8.0-02', name: 'Can use compass to transfer lengths without measuring', grade: 6, x: 180, y: 300 },
            { code: 'G6-PC-8.1-03', name: 'Can use a compass to draw circles with a given radius', grade: 6, x: 180, y: 350 },
            { code: 'G6-PC-8.3-02', name: 'Can construct perpendicular lines using geometric tools', grade: 6, x: 180, y: 400 },
            
            // Grade 6 - Symmetry
            { code: 'G6-SYM-9.1-02', name: 'Can verify if a line is a line of symmetry by checking if the two parts overlap completely when folded along that line', grade: 6, x: 180, y: 500 },
            
            // Grade 7 Stations - Parallel Lines
            { code: 'G7-PIL-5.1-02', name: 'Can identify and measure the four angles formed when two lines intersect', grade: 7, x: 340, y: 200 },
            { code: 'G7-PIL-5.3-02', name: 'Can identify parallel lines as lines on the same plane that never meet however far extended', grade: 7, x: 340, y: 250 },
            { code: 'G7-PIL-5.5-01', name: 'Can identify a transversal as a line that intersects two other lines and recognize that 8 angles are formed', grade: 7, x: 340, y: 300 },
            { code: 'G7-PIL-5.6-01', name: 'Can identify corresponding angles formed when a transversal intersects two lines', grade: 7, x: 340, y: 350 },
            { code: 'G7-PIL-5.6-02', name: 'Can apply the property that corresponding angles are equal when a transversal crosses parallel lines', grade: 7, x: 340, y: 400 },
            { code: 'G7-PIL-5.7-01', name: 'Can construct parallel lines using ruler and set square based on equal corresponding angles', grade: 7, x: 340, y: 450 },
            { code: 'G7-PIL-5.8-01', name: 'Can identify alternate angles formed by a transversal and recognize they are equal for parallel lines', grade: 7, x: 340, y: 500 },
            { code: 'G7-PIL-5.8-02', name: 'Can use relationships between corresponding and vertically opposite angles to prove alternate angles are equal', grade: 7, x: 340, y: 550 },
            { code: 'G7-PIL-NA-01', name: 'Can solve complex problems involving multiple parallel lines and transversals', grade: 7, x: 340, y: 600 },
            
            // Grade 7 - Triangles
            { code: 'G7-TTIL-7.1-02', name: 'Can construct an equilateral triangle using compass and ruler when given a side length', grade: 7, x: 450, y: 250 },
            { code: 'G7-TTIL-7.2-02', name: 'Can construct a triangle given three side lengths using compass and ruler', grade: 7, x: 450, y: 300 },
            { code: 'G7-TTIL-7.2-03', name: 'Can apply the triangle inequality theorem to determine if given lengths can form a triangle', grade: 7, x: 450, y: 350 },
            { code: 'G7-TTIL-7.3-01', name: 'Can construct a triangle given two sides and the included angle (SAS)', grade: 7, x: 450, y: 400 },
            { code: 'G7-TTIL-7.3-04', name: 'Can prove that the sum of angles in any triangle equals 180° using parallel lines', grade: 7, x: 450, y: 450 },
            { code: 'G7-TTIL-7.3-05', name: 'Can find the third angle of a triangle given two angles', grade: 7, x: 450, y: 500 },
            { code: 'G7-TTIL-7.3-06', name: 'Can identify and calculate exterior angles of triangles', grade: 7, x: 450, y: 550 },
            { code: 'G7-TTIL-7.3-07', name: 'Can apply the exterior angle theorem (exterior angle equals sum of non-adjacent interior angles)', grade: 7, x: 450, y: 600 },
            { code: 'G7-TTIL-7.4-01', name: 'Can identify and construct altitudes of triangles from vertices to opposite sides', grade: 7, x: 450, y: 650 },
            { code: 'G7-TTIL-7.4-02', name: 'Can construct altitudes using set square and ruler for precise perpendiculars', grade: 7, x: 450, y: 700 },
            { code: 'G7-TTIL-7.5-01', name: 'Can classify triangles by sides (equilateral, isosceles, scalene) and angles (acute, right, obtuse)', grade: 7, x: 450, y: 750 },
            { code: 'G7-TTIL-7.5-02', name: 'Can identify that acute triangles have all angles less than 90° while obtuse triangles have one angle greater than 90°', grade: 7, x: 450, y: 800 },
            
            // Grade 8 Stations
            { code: 'G8-UQ-3.1-01', name: 'Can identify and classify curves as simple closed curves and polygons', grade: 8, x: 610, y: 200 },
            { code: 'G8-UQ-3.2-01', name: 'Can calculate and verify that the sum of exterior angles of any polygon is 360°', grade: 8, x: 610, y: 250 },
            { code: 'G8-UQ-3.2-02', name: 'Can find the measure of each exterior angle in a regular polygon', grade: 8, x: 610, y: 300 },
            { code: 'G8-UQ-3.3-03', name: 'Can identify parallelograms and use properties of opposite sides and angles', grade: 8, x: 610, y: 350 },
            { code: 'G8-UQ-3.3.4-01', name: 'Can identify and use relationships between adjacent and opposite elements in parallelograms', grade: 8, x: 610, y: 400 },
            
            // Grade 9 Stations
            // Column 1
            { code: 'G9-EG-2-03', name: 'Can state and apply Euclid\'s axioms in mathematical reasoning', grade: 9, x: 780, y: 200 },
            { code: 'G9-EG-2-08', name: 'Can prove simple geometric statements using Euclid\'s axioms and postulates', grade: 9, x: 780, y: 300 },
            { code: 'G9-EG-3-02', name: 'Can differentiate between proved statements (theorems) and accepted truths (axioms/postulates)', grade: 9, x: 780, y: 400 },
            { code: 'G9-EG-4-02', name: 'Can appreciate the role of logical reasoning and proof in mathematics', grade: 9, x: 780, y: 500 },
            { code: 'G9-LA-1-01', name: 'Can identify and explain real-world applications of lines and angles in architecture and science', grade: 9, x: 780, y: 600 },
            { code: 'G9-LA-2-01', name: 'Can distinguish between lines line segments and rays and use appropriate notation', grade: 9, x: 780, y: 700 },
            { code: 'G9-LA-2-02', name: 'Can identify and classify different types of angles (acute right obtuse straight reflex)', grade: 9, x: 780, y: 800 },
            
            // Column 2
            { code: 'G9-LA-2-03', name: 'Can identify adjacent angles and understand their properties including common vertex and arm', grade: 9, x: 880, y: 200 },
            { code: 'G9-LA-6-01', name: 'Can identify and use properties of angles formed by a transversal with parallel lines (corresponding alternate interior co-interior)', grade: 9, x: 880, y: 300 },
            { code: 'G9-LA-6-02', name: 'Can use angle properties to prove lines are parallel (converse theorems)', grade: 9, x: 880, y: 400 },
            { code: 'G9-LA-6-03', name: 'Can solve complex problems involving parallel lines and transversals including finding multiple unknown angles', grade: 9, x: 880, y: 500 },
            { code: 'G9-LA-7-01', name: 'Can construct geometric proofs using properties of lines and angles including deductive reasoning', grade: 9, x: 880, y: 600 },
            { code: 'G9-LA-8-01', name: 'Can apply angle properties to solve real-world problems involving parallel and intersecting lines', grade: 9, x: 880, y: 700 },
            { code: 'G9-TRI-7.1-01', name: 'Can identify triangles and describe their basic elements (sides angles vertices) and notation', grade: 9, x: 880, y: 800 },
            
            // Column 3
            { code: 'G9-TRI-7.2-01', name: 'Can explain the concept of congruence and identify congruent figures in real-world contexts', grade: 9, x: 980, y: 200 },
            { code: 'G9-TRI-7.2-02', name: 'Can establish and verify correspondence between vertices of congruent triangles', grade: 9, x: 980, y: 300 },
            { code: 'G9-TRI-7.2-03', name: 'Can apply the concept of CPCT (Corresponding Parts of Congruent Triangles)', grade: 9, x: 980, y: 400 },
            { code: 'G9-TRI-7.3-02', name: 'Can apply SAS (Side-Angle-Side) congruence criterion correctly including identifying the included angle', grade: 9, x: 980, y: 500 },
            { code: 'G9-TRI-7.3-03', name: 'Can distinguish between valid SAS and invalid SSA or ASS configurations', grade: 9, x: 980, y: 600 },
            { code: 'G9-TRI-7.3-04', name: 'Can apply ASA (Angle-Side-Angle) congruence criterion and prove it using SAS', grade: 9, x: 980, y: 700 },
            { code: 'G9-TRI-7.3-05', name: 'Can apply AAS (Angle-Angle-Side) congruence criterion understanding angle sum property', grade: 9, x: 980, y: 800 },
            
            // Column 4
            { code: 'G9-TRI-7.3-06', name: 'Can explain why AAA (three equal angles) is insufficient for congruence', grade: 9, x: 1080, y: 200 },
            { code: 'G9-TRI-7.3-07', name: 'Can construct logical proofs for triangle congruence using given information', grade: 9, x: 1080, y: 280 },
            { code: 'G9-TRI-7.4-02', name: 'Can prove and apply the isosceles triangle theorem (equal sides imply equal opposite angles)', grade: 9, x: 1080, y: 360 },
            { code: 'G9-TRI-7.4-03', name: 'Can prove and apply the converse of isosceles triangle theorem', grade: 9, x: 1080, y: 440 },
            { code: 'G9-TRI-7.4-04', name: 'Can solve problems involving properties of isosceles triangles in complex figures', grade: 9, x: 1080, y: 520 },
            { code: 'G9-TRI-7.5-01', name: 'Can apply SSS (Side-Side-Side) congruence criterion correctly', grade: 9, x: 1080, y: 600 },
            { code: 'G9-TRI-7.5-02', name: 'Can apply RHS (Right angle-Hypotenuse-Side) congruence criterion for right triangles', grade: 9, x: 1080, y: 680 },
            { code: 'G9-TRI-7.5-03', name: 'Can determine which congruence criterion to apply in different problem contexts', grade: 9, x: 1080, y: 760 },
            { code: 'G9-TRI-7.5-04', name: 'Can prove geometric relationships using congruent triangles (parallel lines perpendicular bisectors)', grade: 9, x: 1080, y: 840 },
            { code: 'G9-TRI-7.6-01', name: 'Can synthesize and apply all congruence criteria appropriately', grade: 9, x: 1080, y: 920 },
            
            // Grade 10 Stations - Reorganized by subsection with proper formatting
            // Introduction subsection
            { code: 'G10-TRI-6.1-01', name: 'Can differentiate between congruent and similar figures', grade: 10, x: 1200, y: 220 },
            
            // Similar Figures subsection  
            { code: 'G10-TRI-6.2-01', name: 'Can identify similar figures and explain why they are similar', grade: 10, x: 1200, y: 300 },
            { code: 'G10-TRI-6.2-02', name: 'Can determine if two polygons are similar by verifying corresponding angles are equal and corresponding sides are proportional', grade: 10, x: 1200, y: 350 },
            { code: 'G10-TRI-6.2-03', name: 'Can calculate scale factor and use it to find unknown measurements in similar figures', grade: 10, x: 1200, y: 400 },
            
            // Similarity of Triangles subsection - split into 2 columns
            { code: 'G10-TRI-6.3-01', name: 'Can apply the Basic Proportionality Theorem (Thales Theorem) to solve problems', grade: 10, x: 1200, y: 480 },
            { code: 'G10-TRI-6.3-02', name: 'Can prove and apply that a line parallel to one side of a triangle divides the other two sides proportionally', grade: 10, x: 1200, y: 530 },
            { code: 'G10-TRI-6.3-03', name: 'Can prove and apply the converse of Basic Proportionality Theorem', grade: 10, x: 1330, y: 480 },
            { code: 'G10-TRI-6.3-04', name: 'Can use properties of similar triangles to solve complex problems involving multiple triangles', grade: 10, x: 1330, y: 530 },
            
            // Criteria for Similarity of Triangles subsection
            { code: 'G10-TRI-6.4-01', name: 'Can apply AAA (or AA) similarity criterion to prove triangles are similar', grade: 10, x: 1200, y: 610 },
            { code: 'G10-TRI-6.4-02', name: 'Can apply SSS similarity criterion to prove triangles are similar', grade: 10, x: 1200, y: 660 },
            { code: 'G10-TRI-6.4-03', name: 'Can apply SAS similarity criterion to prove triangles are similar', grade: 10, x: 1200, y: 710 },
            { code: 'G10-TRI-6.4-04', name: 'Can determine which similarity criterion to use in a given problem', grade: 10, x: 1330, y: 610 },
            { code: 'G10-TRI-6.4-05', name: 'Can solve real-world problems using triangle similarity', grade: 10, x: 1330, y: 660 },
            { code: 'G10-TRI-6.4-06', name: 'Can distinguish between similarity and congruence criteria and apply them correctly', grade: 10, x: 1330, y: 710 },
            
            // Extended Learning subsection
            { code: 'G10-TRI-ADV-01', name: 'Can prove properties of similar triangles including ratios of corresponding altitudes and medians', grade: 10, x: 1200, y: 790 },
            { code: 'G10-TRI-ADV-02', name: 'Can apply similarity concepts to prove theorems like Pythagoras theorem', grade: 10, x: 1200, y: 840 }
        ];

        // Updated connections with requested changes
        const connections = [
            // Basic geometric concepts needed throughout
            { from: 'G6-LA-2.2-01', to: 'G6-LA-2.5-01' },
            { from: 'G6-LA-2.5-01', to: 'G6-LA-2.5-02' },
            { from: 'G6-LA-2.5-02', to: 'G6-LA-2.8-02' },
            { from: 'G6-LA-2.8-02', to: 'G6-LA-2.8-03' },
            { from: 'G6-LA-2.5-01', to: 'G6-LA-2.9-02' },
            { from: 'G6-LA-2.9-02', to: 'G6-LA-2.9-03' },
            { from: 'G6-LA-2.9-03', to: 'G6-LA-2.10-01' },
            { from: 'G6-LA-2.8-03', to: 'G6-LA-2.11-04' },
            { from: 'G6-LA-2.5-01', to: 'G6-LA-2.11-05' },
            { from: 'G6-LA-2.8-02', to: 'G6-LA-NA-02' },
            
            // Compass skills
            { from: 'G6-PC-8.0-02', to: 'G6-PC-8.1-03' },
            { from: 'G6-LA-NA-02', to: 'G6-PC-8.3-02' },
            
            // Grade 7 - Parallel Lines
            { from: 'G6-LA-2.5-01', to: 'G7-PIL-5.1-02' },
            { from: 'G6-LA-2.9-02', to: 'G7-PIL-5.1-02' },
            { from: 'G6-LA-2.2-01', to: 'G7-PIL-5.3-02' },
            { from: 'G7-PIL-5.3-02', to: 'G7-PIL-5.5-01' },
            { from: 'G7-PIL-5.1-02', to: 'G7-PIL-5.5-01' },
            { from: 'G7-PIL-5.5-01', to: 'G7-PIL-5.6-01' },
            { from: 'G7-PIL-5.6-01', to: 'G7-PIL-5.6-02' },
            { from: 'G7-PIL-5.6-02', to: 'G7-PIL-5.7-01' },
            { from: 'G6-LA-2.10-01', to: 'G7-PIL-5.7-01' },
            { from: 'G7-PIL-5.6-01', to: 'G7-PIL-5.8-01' },
            { from: 'G7-PIL-5.1-02', to: 'G7-PIL-5.8-01' },
            { from: 'G7-PIL-5.8-01', to: 'G7-PIL-5.8-02' },
            { from: 'G7-PIL-5.6-02', to: 'G7-PIL-5.8-02' },
            { from: 'G7-PIL-5.8-02', to: 'G7-PIL-NA-01' },
            
            // Grade 7 - Triangles
            { from: 'G6-PC-8.1-03', to: 'G7-TTIL-7.1-02' },
            { from: 'G6-PC-8.0-02', to: 'G7-TTIL-7.2-02' },
            { from: 'G7-TTIL-7.1-02', to: 'G7-TTIL-7.2-02' },
            { from: 'G6-LA-2.2-01', to: 'G7-TTIL-7.2-03' },
            { from: 'G7-TTIL-7.2-02', to: 'G7-TTIL-7.2-03' },
            { from: 'G6-LA-2.10-01', to: 'G7-TTIL-7.3-01' },
            { from: 'G7-TTIL-7.2-02', to: 'G7-TTIL-7.3-01' },
            { from: 'G7-PIL-5.8-01', to: 'G7-TTIL-7.3-04' },
            { from: 'G7-PIL-5.3-02', to: 'G7-TTIL-7.3-04' },
            { from: 'G7-TTIL-7.3-04', to: 'G7-TTIL-7.3-05' },
            { from: 'G7-TTIL-7.3-04', to: 'G7-TTIL-7.3-06' },
            { from: 'G7-TTIL-7.3-06', to: 'G7-TTIL-7.3-07' },
            { from: 'G6-PC-8.3-02', to: 'G7-TTIL-7.4-01' },
            { from: 'G6-LA-NA-02', to: 'G7-TTIL-7.4-01' },
            { from: 'G7-TTIL-7.4-01', to: 'G7-TTIL-7.4-02' },
            { from: 'G6-LA-2.8-03', to: 'G7-TTIL-7.5-01' },
            { from: 'G7-TTIL-7.2-02', to: 'G7-TTIL-7.5-01' },
            { from: 'G7-TTIL-7.5-01', to: 'G7-TTIL-7.5-02' },
            
            // Grade 8 - Polygons
            { from: 'G7-TTIL-7.5-01', to: 'G8-UQ-3.1-01' },
            { from: 'G7-TTIL-7.3-06', to: 'G8-UQ-3.2-01' },
            { from: 'G7-TTIL-7.3-07', to: 'G8-UQ-3.2-01' },
            { from: 'G8-UQ-3.2-01', to: 'G8-UQ-3.2-02' },
            { from: 'G7-PIL-5.3-02', to: 'G8-UQ-3.3-03' },
            { from: 'G8-UQ-3.1-01', to: 'G8-UQ-3.3-03' },
            { from: 'G8-UQ-3.3-03', to: 'G8-UQ-3.3.4-01' },
            
            // Grade 9 - Euclidean Geometry and Proofs
            { from: 'G6-LA-2.5-01', to: 'G9-EG-2-03' },
            { from: 'G9-EG-2-03', to: 'G9-EG-2-08' },
            { from: 'G9-EG-2-08', to: 'G9-EG-3-02' },
            { from: 'G9-EG-3-02', to: 'G9-EG-4-02' },
            
            // Grade 9 - Lines and Angles (advanced)
            { from: 'G6-LA-2.2-01', to: 'G9-LA-2-01' },
            { from: 'G6-LA-2.11-05', to: 'G9-LA-1-01' },
            { from: 'G6-LA-2.8-03', to: 'G9-LA-2-02' },
            { from: 'G7-PIL-5.1-02', to: 'G9-LA-2-02' },
            { from: 'G6-LA-2.5-01', to: 'G9-LA-2-03' },
            { from: 'G7-PIL-5.1-02', to: 'G9-LA-2-03' },
            { from: 'G7-PIL-5.6-02', to: 'G9-LA-6-01' },
            { from: 'G7-PIL-5.8-01', to: 'G9-LA-6-01' },
            { from: 'G7-PIL-NA-01', to: 'G9-LA-6-01' },
            { from: 'G9-LA-6-01', to: 'G9-LA-6-02' },
            { from: 'G9-EG-2-08', to: 'G9-LA-6-02' },
            { from: 'G9-LA-6-02', to: 'G9-LA-6-03' },
            { from: 'G9-EG-2-08', to: 'G9-LA-7-01' },
            { from: 'G9-LA-6-03', to: 'G9-LA-7-01' },
            { from: 'G9-LA-6-03', to: 'G9-LA-8-01' },
            
            // Grade 9 - Triangle Congruence
            { from: 'G7-TTIL-7.5-01', to: 'G9-TRI-7.1-01' },
            { from: 'G9-TRI-7.1-01', to: 'G9-TRI-7.2-01' },
            { from: 'G6-SYM-9.1-02', to: 'G9-TRI-7.2-01' },
            { from: 'G9-TRI-7.2-01', to: 'G9-TRI-7.2-02' },
            { from: 'G9-TRI-7.2-02', to: 'G9-TRI-7.2-03' },
            { from: 'G7-TTIL-7.3-01', to: 'G9-TRI-7.3-02' },
            { from: 'G9-TRI-7.2-02', to: 'G9-TRI-7.3-02' },
            { from: 'G9-TRI-7.3-02', to: 'G9-TRI-7.3-03' },
            { from: 'G9-TRI-7.2-02', to: 'G9-TRI-7.3-04' },
            { from: 'G7-TTIL-7.3-04', to: 'G9-TRI-7.3-04' },
            { from: 'G9-TRI-7.3-04', to: 'G9-TRI-7.3-05' },
            { from: 'G7-TTIL-7.3-04', to: 'G9-TRI-7.3-06' },
            { from: 'G9-TRI-7.3-06', to: 'G9-TRI-7.3-07' },
            { from: 'G9-EG-2-08', to: 'G9-TRI-7.3-07' },
            { from: 'G9-TRI-7.2-03', to: 'G9-TRI-7.3-07' },
            { from: 'G7-TTIL-7.5-01', to: 'G9-TRI-7.4-02' },
            { from: 'G9-TRI-7.2-03', to: 'G9-TRI-7.4-02' },
            { from: 'G9-TRI-7.4-02', to: 'G9-TRI-7.4-03' },
            { from: 'G9-TRI-7.4-03', to: 'G9-TRI-7.4-04' },
            { from: 'G7-TTIL-7.2-02', to: 'G9-TRI-7.5-01' },
            { from: 'G9-TRI-7.2-02', to: 'G9-TRI-7.5-01' },
            { from: 'G6-LA-2.8-02', to: 'G9-TRI-7.5-02' },
            { from: 'G7-TTIL-7.5-01', to: 'G9-TRI-7.5-02' },
            { from: 'G9-TRI-7.3-02', to: 'G9-TRI-7.5-03' },
            { from: 'G9-TRI-7.3-04', to: 'G9-TRI-7.5-03' },
            { from: 'G9-TRI-7.5-01', to: 'G9-TRI-7.5-03' },
            { from: 'G9-TRI-7.5-02', to: 'G9-TRI-7.5-03' },
            { from: 'G9-TRI-7.5-03', to: 'G9-TRI-7.5-04' },
            { from: 'G9-LA-7-01', to: 'G9-TRI-7.5-04' },
            { from: 'G9-TRI-7.5-03', to: 'G9-TRI-7.6-01' },
            
            // Grade 10 - Similarity (with requested changes)
            { from: 'G9-TRI-7.2-01', to: 'G10-TRI-6.1-01' },
            { from: 'G9-TRI-7.6-01', to: 'G10-TRI-6.1-01' },
            { from: 'G10-TRI-6.1-01', to: 'G10-TRI-6.2-01' },
            { from: 'G8-UQ-3.1-01', to: 'G10-TRI-6.2-01' },
            { from: 'G7-TTIL-7.5-01', to: 'G10-TRI-6.2-01' }, // Added as immediate
            { from: 'G10-TRI-6.2-01', to: 'G10-TRI-6.2-02' },
            { from: 'G6-LA-2.9-02', to: 'G10-TRI-6.2-02' },
            // Removed: { from: 'G7-TTIL-7.3-04', to: 'G10-TRI-6.2-02' },
            { from: 'G10-TRI-6.2-02', to: 'G10-TRI-6.2-03' },
            
            // Basic Proportionality Theorem
            { from: 'G7-PIL-5.3-02', to: 'G10-TRI-6.3-01' },
            { from: 'G9-LA-6-01', to: 'G10-TRI-6.3-01' },
            { from: 'G10-TRI-6.2-03', to: 'G10-TRI-6.3-01' },
            { from: 'G9-LA-7-01', to: 'G10-TRI-6.3-01' }, // Added as immediate
            { from: 'G10-TRI-6.3-01', to: 'G10-TRI-6.3-02' },
            { from: 'G9-LA-7-01', to: 'G10-TRI-6.3-02' },
            { from: 'G10-TRI-6.3-02', to: 'G10-TRI-6.3-03' },
            { from: 'G9-LA-6-02', to: 'G10-TRI-6.3-03' },
            { from: 'G10-TRI-6.3-01', to: 'G10-TRI-6.3-04' },
            { from: 'G10-TRI-6.2-02', to: 'G10-TRI-6.3-04' },
            
            // Similarity Criteria (with requested changes)
            { from: 'G10-TRI-6.2-01', to: 'G10-TRI-6.4-01' },
            // Removed: { from: 'G7-TTIL-7.3-04', to: 'G10-TRI-6.4-01' },
            { from: 'G9-TRI-7.3-06', to: 'G10-TRI-6.4-01' },
            { from: 'G10-TRI-6.2-03', to: 'G10-TRI-6.4-02' },
            { from: 'G9-TRI-7.5-01', to: 'G10-TRI-6.4-02' },
            { from: 'G10-TRI-6.2-03', to: 'G10-TRI-6.4-03' },
            { from: 'G9-TRI-7.3-02', to: 'G10-TRI-6.4-03' },
            { from: 'G10-TRI-6.4-01', to: 'G10-TRI-6.4-04' },
            { from: 'G10-TRI-6.4-02', to: 'G10-TRI-6.4-04' },
            { from: 'G10-TRI-6.4-03', to: 'G10-TRI-6.4-04' },
            { from: 'G9-TRI-7.5-03', to: 'G10-TRI-6.4-04' },
            { from: 'G10-TRI-6.4-04', to: 'G10-TRI-6.4-05' },
            { from: 'G10-TRI-6.2-03', to: 'G10-TRI-6.4-05' },
            { from: 'G10-TRI-6.1-01', to: 'G10-TRI-6.4-06' },
            { from: 'G10-TRI-6.4-04', to: 'G10-TRI-6.4-06' },
            { from: 'G9-TRI-7.6-01', to: 'G10-TRI-6.4-06' },
            
            // Advanced Topics
            { from: 'G7-TTIL-7.4-01', to: 'G10-TRI-ADV-01' },
            { from: 'G10-TRI-6.4-02', to: 'G10-TRI-ADV-01' },
            { from: 'G10-TRI-6.2-03', to: 'G10-TRI-ADV-01' },
            { from: 'G9-TRI-7.5-02', to: 'G10-TRI-ADV-02' },
            { from: 'G10-TRI-6.4-01', to: 'G10-TRI-ADV-02' },
            { from: 'G10-TRI-6.3-04', to: 'G10-TRI-ADV-02' },
            { from: 'G9-LA-7-01', to: 'G10-TRI-ADV-02' }
        ];

        // State variables
        let selectedStation = null;
        let selectedLevels = {1: false, 2: false};
        let currentTransform = d3.zoomIdentity;
        let tooltipPersistent = false;

        // Function to launch quiz
function launchQuiz(competencyCode) {
    if (!quizDatabase[competencyCode]) {
        alert('Quiz not available for this competency yet.');
        return;
    }
    
    activeQuiz = competencyCode;
    currentQuestionIndex = 0;
    userAnswer = null;
    
    const player = document.getElementById('quizPlayer');
    player.classList.add('show');
    
    showQuestion();
}

// Function to close quiz
function closeQuiz() {
    const player = document.getElementById('quizPlayer');
    player.classList.remove('show');
    activeQuiz = null;
}

// ... (add all other quiz functions here) ...

        // Initialize level checkboxes
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('level-1').addEventListener('change', (e) => {
                selectedLevels[1] = e.target.checked;
                updateVisualization();
            });
            document.getElementById('level-2').addEventListener('change', (e) => {
                selectedLevels[2] = e.target.checked;
                updateVisualization();
            });
        });

        // Calculate prerequisite levels for each competency
        function calculatePrerequisiteLevels(targetCode) {
            const levels = { 1: [], 2: [] };
            const allAssigned = new Set();
            
            // Level 1: Direct prerequisites (immediate dependencies)
            const directPrereqs = connections.filter(c => c.to === targetCode);
            directPrereqs.forEach(prereq => {
                const station = stations.find(s => s.code === prereq.from);
                if (station && !allAssigned.has(station.code)) {
                    levels[1].push(station);
                    allAssigned.add(station.code);
                }
            });
            
            // Level 2: Direct prerequisites of Level 1 stations
            const level2Candidates = new Set();
            levels[1].forEach(level1Station => {
                const prereqsOfLevel1 = connections.filter(c => c.to === level1Station.code);
                prereqsOfLevel1.forEach(prereq => {
                    if (!allAssigned.has(prereq.from)) {
                        level2Candidates.add(prereq.from);
                    }
                });
            });
            
            level2Candidates.forEach(code => {
                const station = stations.find(s => s.code === code);
                if (station) {
                    levels[2].push(station);
                    allAssigned.add(station.code);
                }
            });
            
            // Sort each level by grade and position
            Object.keys(levels).forEach(level => {
                levels[level].sort((a, b) => {
                    if (a.grade !== b.grade) return a.grade - b.grade;
                    if (a.x !== b.x) return a.x - b.x;
                    return a.y - b.y;
                });
            });
            
            return levels;
        }
        
        function initializeVisualization() {
            const svg = d3.select('#metro-svg');
            const container = document.querySelector('.main-area');
            const width = 1800;
            const height = 1200;
            
            svg.attr('width', width).attr('height', height);
            
            // Create main group for zooming
            const g = svg.append('g');
            
            // Add zoom behavior with touch support
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    currentTransform = event.transform;
                    g.attr('transform', event.transform);
                })
                .filter(function(event) {
                    // Allow all events (mouse, touch, etc.)
                    return true;
                });
            
            svg.call(zoom);
            
            // Draw grade zones
            const gradeZones = [
                { grade: 6, x: 50, y: 150, width: 250, height: 600 },
                { grade: 7, x: 320, y: 150, width: 250, height: 700 },
                { grade: 8, x: 590, y: 150, width: 150, height: 300 },
                { grade: 9, x: 760, y: 150, width: 400, height: 950 },
                { grade: 10, x: 1180, y: 150, width: 300, height: 850 }
            ];
            
            const zones = g.selectAll('.grade-zone')
                .data(gradeZones)
                .enter()
                .append('g');
            
            zones.append('rect')
                .attr('class', d => `grade-zone grade-${d.grade}-zone`)
                .attr('x', d => d.x)
                .attr('y', d => d.y)
                .attr('width', d => d.width)
                .attr('height', d => d.height)
                .attr('rx', 10);
            
            zones.append('text')
                .attr('class', d => `zone-label${d.grade === 10 ? ' grade-10' : ''}`)
                .attr('x', d => d.x + d.width / 2)
                .attr('y', d => d.y + 30)
                .attr('text-anchor', 'middle')
                .text(d => `GRADE ${d.grade}`);
            
            // Draw connection paths (after chapter backgrounds)
            const connectionsGroup = g.append('g').attr('class', 'connections-group');
            
            connections.forEach(conn => {
                const fromStation = stations.find(s => s.code === conn.from);
                const toStation = stations.find(s => s.code === conn.to);
                
                if (fromStation && toStation) {
                    connectionsGroup.append('line')
                        .attr('class', 'connection-path')
                        .attr('x1', fromStation.x)
                        .attr('y1', fromStation.y)
                        .attr('x2', toStation.x)
                        .attr('y2', toStation.y)
                        .attr('data-from', conn.from)
                        .attr('data-to', conn.to);
                }
            });
            
            // Remove chapter headers for grades 6-9 to keep clean appearance
            // Focus on Grade 10 subsections which are working well
            
            // Add subsection headers for Grade 10
            const subsectionHeaders = g.append('g').attr('class', 'subsection-headers');
            
            const subsectionData = [
                { name: 'Introduction', y: 190 },
                { name: 'Similar Figures', y: 270 },
                { name: 'Similarity of Triangles', y: 450 },
                { name: 'Criteria for Similarity of Triangles', y: 580 },
                { name: 'Extended Learning', y: 760 }
            ];
            
            subsectionHeaders.selectAll('.subsection-header')
                .data(subsectionData)
                .enter()
                .append('text')
                .attr('class', 'subsection-header')
                .attr('x', 1190)
                .attr('y', d => d.y)
                .attr('text-anchor', 'start')
                .style('font-size', '13px')
                .style('font-weight', 'bold')
                .style('fill', '#5a4a00')
                .style('opacity', 0.8)
                .text(d => d.name);
            
            // Create a group for sequential paths (will be drawn on top)
            const sequentialGroup = g.append('g').attr('class', 'sequential-group');
            
            // Create pencil indicator
            const pencilGroup = g.append('g')
                .attr('class', 'pencil-indicator')
                .attr('opacity', 0);
            
            // Create pencil SVG - positioned so tip is at origin (0,0)
            const pencilPath = pencilGroup.append('g')
                .attr('transform', 'scale(2) rotate(-45) translate(-3, -3)'); // Center the tip at origin
            
            // Pencil tip (dark gray) - tip starts at (3,0)
            pencilPath.append('path')
                .attr('d', 'M0,10 L3,0 L6,10 Z')
                .attr('fill', '#4a4a4a')
                .attr('stroke', '#2a2a2a')
                .attr('stroke-width', '0.5');
            
            // Wood part (beige)
            pencilPath.append('rect')
                .attr('x', 0)
                .attr('y', 10)
                .attr('width', 6)
                .attr('height', 8)
                .attr('fill', '#f4d1a6')
                .attr('stroke', '#d4a574')
                .attr('stroke-width', '0.5');
            
            // Yellow body
            pencilPath.append('rect')
                .attr('x', 0)
                .attr('y', 18)
                .attr('width', 6)
                .attr('height', 20)
                .attr('fill', '#ffd700')
                .attr('stroke', '#e6c200')
                .attr('stroke-width', '0.5');
            
            // Orange stripe
            pencilPath.append('rect')
                .attr('x', 0)
                .attr('y', 26)
                .attr('width', 6)
                .attr('height', 4)
                .attr('fill', '#ff8c00')
                .attr('stroke', '#e67c00')
                .attr('stroke-width', '0.5');
            
            // Metal band
            pencilPath.append('rect')
                .attr('x', 0)
                .attr('y', 38)
                .attr('width', 6)
                .attr('height', 3)
                .attr('fill', '#c0c0c0')
                .attr('stroke', '#a0a0a0')
                .attr('stroke-width', '0.5');
            
            // Pink eraser
            pencilPath.append('rect')
                .attr('x', 0)
                .attr('y', 41)
                .attr('width', 6)
                .attr('height', 6)
                .attr('rx', 1)
                .attr('fill', '#ffb6c1')
                .attr('stroke', '#ff91a4')
                .attr('stroke-width', '0.5');
            
            // Graphite line in center
            pencilPath.append('line')
                .attr('x1', 3)
                .attr('y1', 3)
                .attr('x2', 3)
                .attr('y2', 10)
                .attr('stroke', '#2a2a2a')
                .attr('stroke-width', '1');
            
            // Store pencil reference
            window.pencilIndicator = pencilGroup;
            
            // Draw stations
            const stationsGroup = g.append('g').attr('class', 'stations-group');
            
            const stationGroups = stationsGroup.selectAll('.station')
                .data(stations)
                .enter()
                .append('g')
                .attr('class', d => `station grade-${d.grade}`)
                .attr('transform', d => `translate(${d.x}, ${d.y})`)
                .on('mouseenter', handleStationHover)
                .on('mouseleave', handleStationLeave)
                .on('click', handleStationClick)
                .on('touchstart', function(event, d) {
                    event.preventDefault();
                    handleStationHover(event, d);
                })
                .on('touchend', function(event, d) {
                    event.preventDefault();
                    handleStationLeave();
                    handleStationClick(event, d);
                });
            
            stationGroups.append('circle')
                .attr('class', 'station-circle')
                .attr('r', 8);
            
            // Remove station code labels for visual clarity
            // stationGroups.append('text')
            //     .attr('class', 'station-label')
            //     .attr('x', 15)
            //     .attr('y', 4)
            //     .text(d => d.code);
            
            // Store references
            window.svg = svg;
            window.g = g;
            window.zoom = zoom;
            
            // Set initial zoom based on device type and screen size
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            const isMobile = window.innerWidth <= 768;
            
            let scale, translateX, translateY;
            
            if (isMobile) {
                // Mobile devices - show Grade 10 prominently
                if (window.innerWidth <= 480) {
                    // Very small screens
                    scale = 0.4;
                    translateX = -400;
                    translateY = -50;
                } else {
                    // Tablets and larger phones
                    scale = 0.5;
                    translateX = -300;
                    translateY = -50;
                }
            } else {
                // Desktop/laptop screens
                if (containerWidth < 1200) {
                    // Smaller laptop screen (1366x768)
                    scale = 0.65;
                    translateX = -20;
                    translateY = -80;
                } else {
                    // Larger laptop screen (1920x1080) or bigger
                    scale = 0.75;
                    translateX = 50;
                    translateY = -50;
                }
            }
            
            // Apply initial transform
            svg.call(zoom.transform, d3.zoomIdentity.translate(translateX, translateY).scale(scale));
        }
        
        // Interaction handlers
        function handleStationHover(event, d) {
            // Don't show tooltip on touch devices during pan/zoom
            if (event.sourceEvent && event.sourceEvent.type === 'touchmove') return;
            
            // If hovering over the selected station, don't show hover tooltip
            if (selectedStation === d.code) return;
            
            // Show hover tooltip
            const hoverTooltip = document.querySelector('.tooltip-hover');
            const data = competencyData[d.code];
            
            if (d.grade === 10) {
                // Grade 10 format - only competency with See More button
                hoverTooltip.innerHTML = `
                    <div class="code">${d.code}</div>
                    <strong>Competency:</strong> ${data ? data.competency : d.name}
                `;
            } else {
                // Other grades format
                const chapter = data ? data.chapter : 'Unknown Chapter';
                const subsection = data ? data.subsection : 'Unknown Subsection';
                hoverTooltip.innerHTML = `
                    <div class="code">${d.code}</div>
                    <strong>Chapter:</strong> ${chapter}<br>
                    <strong>Sub-section:</strong> ${subsection}<br><br>
                    <strong>Competency:</strong> ${data ? data.competency : d.name}<br><br>
                    <strong>Misconceptions:</strong> ${data && data.misconception ? data.misconception : 'No common misconceptions listed'}
                `;
            }
            
            hoverTooltip.classList.add('show');
            
            // Position hover tooltip
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
                const tooltipWidth = 250;
                hoverTooltip.style.left = Math.max(10, Math.min(window.innerWidth - tooltipWidth - 10, event.pageX - tooltipWidth/2)) + 'px';
                hoverTooltip.style.top = Math.max(10, event.pageY - hoverTooltip.offsetHeight - 10) + 'px';
            } else {
                hoverTooltip.style.left = (event.pageX + 10) + 'px';
                hoverTooltip.style.top = (event.pageY - 10) + 'px';
            }
        }
        
        function handleStationLeave() {
            // Always hide hover tooltip on leave
            document.querySelector('.tooltip-hover').classList.remove('show');
        }
        
        function showTooltip(event, stationData, isPersistent) {
            const tooltip = document.querySelector('.tooltip');
            const data = competencyData[stationData.code];
            
            if (stationData.grade === 10) {
                // Grade 10 format - only competency with See More button
                tooltip.innerHTML = `
                    <div class="code">${stationData.code}</div>
                    <strong>Competency:</strong> ${data ? data.competency : stationData.name}<br>
                    <button class="see-more-btn" onclick="showModal('${stationData.code}')">See More</button>
                `;
            } else {
                // Other grades format
                const chapter = data ? data.chapter : 'Unknown Chapter';
                const subsection = data ? data.subsection : 'Unknown Subsection';
                tooltip.innerHTML = `
                    <div class="code">${stationData.code}</div>
                    <strong>Chapter:</strong> ${chapter}<br>
                    <strong>Sub-section:</strong> ${subsection}<br><br>
                    <strong>Competency:</strong> ${data ? data.competency : stationData.name}<br><br>
                    <strong>Misconceptions:</strong> ${data && data.misconception ? data.misconception : 'No common misconceptions listed'}
                `;
            }
            
            tooltip.classList.add('show');
            
            if (isPersistent) {
                tooltip.classList.add('persistent');
                tooltipPersistent = true;
            } else {
                tooltip.classList.remove('persistent');
                tooltipPersistent = false;
            }
            
            // Position tooltip better for mobile
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
                // Center tooltip on mobile
                const tooltipWidth = 250;
                tooltip.style.left = Math.max(10, Math.min(window.innerWidth - tooltipWidth - 10, event.pageX - tooltipWidth/2)) + 'px';
                tooltip.style.top = Math.max(10, event.pageY - tooltip.offsetHeight - 10) + 'px';
            } else {
                tooltip.style.left = (event.pageX + 10) + 'px';
                tooltip.style.top = (event.pageY - 10) + 'px';
            }
        }
        
        function hideTooltip() {
            const tooltip = document.querySelector('.tooltip');
            tooltip.classList.remove('show', 'persistent');
            tooltipPersistent = false;
        }
        
        function handleStationClick(event, d) {
            // Prevent click during pan on mobile
            if (event.defaultPrevented) return;
            
            // If clicking the same station, deselect it
            if (selectedStation === d.code) {
                selectedStation = null;
                hideTooltip();
                updateVisualization();
                return;
            }
            
            // Hide any previous persistent tooltip
            hideTooltip();
            
            selectedStation = d.code;
            
            // Show persistent tooltip for the selected station
            showTooltip(event, d, true);
            
            updateVisualization();
            
            // On mobile, scroll to show prerequisites panel
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    document.getElementById('prerequisites-panel').scrollIntoView({ behavior: 'smooth' });
                }, 300);
            }
        }
        
        function updateVisualization() {
            // Clear previous highlights and paths
            d3.selectAll('.station').classed('highlighted', false).classed('active', false).classed('dimmed', false);
            d3.selectAll('.sequential-path').remove();
            
            // Hide pencil indicator if no station selected
            if (!selectedStation) {
                window.pencilIndicator.classed('active', false);
                document.getElementById('prerequisites-panel').classList.remove('show');
                // Hide tooltip if no station is selected
                hideTooltip();
                return;
            }
            
            // Find the selected station element and highlight it
            let selectedStationData = null;
            d3.selectAll('.station').each(function(d) {
                if (d.code === selectedStation) {
                    d3.select(this).classed('highlighted', true);
                    selectedStationData = d;
                }
            });
            
            // Position and show pencil indicator with tip pointing to station
            if (selectedStationData && window.pencilIndicator) {
                // Simply position the pencil at the station center
                // The pencil SVG is already set up so the tip is at the origin
                window.pencilIndicator
                    .attr('transform', `translate(${selectedStationData.x}, ${selectedStationData.y})`)
                    .classed('active', true);
            }
            
            // Calculate prerequisite levels
            const levels = calculatePrerequisiteLevels(selectedStation);
            const targetStation = stations.find(s => s.code === selectedStation);
            
            // Check if any level is selected
            const anyLevelSelected = selectedLevels[1] || selectedLevels[2];
            
            // Only show prerequisites if at least one level is selected
            if (anyLevelSelected) {
                // Create connections for each level separately
                const levelConnections = {
                    1: [],
                    2: []
                };
                
                // For each level, find all connections between stations in the path
                [1, 2].forEach(level => {
                    if (!selectedLevels[level]) return;
                    
                    const levelStations = levels[level];
                    const allStationsUpToLevel = [];
                    
                    // Include all stations up to this level plus the target
                    for (let i = 1; i <= level; i++) {
                        if (selectedLevels[i]) {  // Only include if this level is selected
                            allStationsUpToLevel.push(...levels[i]);
                        }
                    }
                    allStationsUpToLevel.push(targetStation);
                    
                    // Find connections between these stations
                    connections.forEach(conn => {
                        const fromStation = allStationsUpToLevel.find(s => s.code === conn.from);
                        const toStation = allStationsUpToLevel.find(s => s.code === conn.to);
                        
                        if (fromStation && toStation) {
                            levelConnections[level].push({
                                from: fromStation,
                                to: toStation,
                                level: level
                            });
                        }
                    });
                });
                
                // Draw paths for each level with appropriate colors
                const sequentialGroup = d3.select('.sequential-group');
                let pathIndex = 0;
                
                [2, 1].forEach(level => { // Draw in reverse order so level 1 is on top
                    if (!selectedLevels[level]) return;
                    
                    levelConnections[level].forEach((conn, i) => {
                        sequentialGroup.append('line')
                            .attr('class', `sequential-path level-${level}`)
                            .attr('x1', conn.from.x)
                            .attr('y1', conn.from.y)
                            .attr('x2', conn.to.x)
                            .attr('y2', conn.to.y)
                            .style('opacity', 0)
                            .transition()
                            .delay(pathIndex * 30)
                            .duration(200)
                            .style('opacity', 1)
                            .attr('class', `sequential-path level-${level} active`);
                        
                        pathIndex++;
                    });
                });
                
                // Highlight all stations in selected levels
                const allSelectedStations = [];
                [1, 2].forEach(level => {
                    if (selectedLevels[level]) {
                        allSelectedStations.push(...levels[level]);
                    }
                });
                allSelectedStations.push(targetStation);
                
                // Dim all stations first
                d3.selectAll('.station').classed('dimmed', true);
                
                // Then highlight only selected stations
                allSelectedStations.forEach((station, idx) => {
                    setTimeout(() => {
                        d3.selectAll('.station').each(function(sd) {
                            if (sd.code === station.code) {
                                d3.select(this).classed('active', true).classed('dimmed', false);
                            }
                        });
                    }, idx * 30);
                });
            } else {
                // If no levels selected, only highlight the selected station
                d3.selectAll('.station').classed('dimmed', true);
                d3.selectAll('.station').each(function(d) {
                    if (d.code === selectedStation) {
                        d3.select(this).classed('dimmed', false);
                    }
                });
            }
            
            // Show prerequisites panel
            showPrerequisitesPanel(targetStation, levels);
        }
        
        function showPrerequisitesPanel(targetStation, levels) {
            const panel = document.getElementById('prerequisites-panel');
            const content = document.getElementById('prerequisites-content');
            
            // Clear previous content
            content.innerHTML = '';
            
            // Add header
            const header = document.createElement('div');
            header.innerHTML = `<strong>${targetStation.code}</strong><br>${targetStation.name}`;
            header.style.marginBottom = '15px';
            header.style.fontSize = '12px';
            header.style.color = '#2c3e50';
            content.appendChild(header);
            
            // Check if any level is selected
            const anyLevelSelected = selectedLevels[1] || selectedLevels[2];
            
            if (!anyLevelSelected) {
                const noSelectionMessage = document.createElement('div');
                noSelectionMessage.style.fontSize = '11px';
                noSelectionMessage.style.color = '#666';
                noSelectionMessage.style.fontStyle = 'italic';
                noSelectionMessage.innerHTML = 'Select prerequisite levels to view dependencies';
                content.appendChild(noSelectionMessage);
            } else {
                // Show each selected level
                [1, 2].forEach(level => {
                    if (selectedLevels[level] && levels[level].length > 0) {
                        const section = document.createElement('div');
                        section.className = 'prerequisite-section';
                        
                        const sectionHeader = document.createElement('h4');
                        sectionHeader.innerHTML = `<span class="level-indicator level-${level}">${level}</span>`;
                        
                        if (level === 1) {
                            sectionHeader.innerHTML += 'Immediate Prerequisites';
                        } else {
                            sectionHeader.innerHTML += 'Supporting Prerequisites';
                        }
                        
                        section.appendChild(sectionHeader);
                        
                        levels[level].forEach(prereq => {
                            const item = document.createElement('div');
                            item.className = `prerequisite-item level-${level} grade-${prereq.grade}`;
                            item.innerHTML = `
                                <div class="prerequisite-code">${prereq.code}</div>
                                <div class="prerequisite-desc">${prereq.name}</div>
                            `;
                            section.appendChild(item);
                        });
                        
                        content.appendChild(section);
                    }
                });
                
                // Add summary only if levels are selected
                const selectedLevelCounts = [1, 2].filter(level => selectedLevels[level]);
                if (selectedLevelCounts.length > 0) {
                    const counts = {
                        1: selectedLevels[1] ? levels[1].length : 0,
                        2: selectedLevels[2] ? levels[2].length : 0
                    };
                    const totalCount = counts[1] + counts[2];
                    
                    const summary = document.createElement('div');
                    summary.style.marginTop = '15px';
                    summary.style.fontSize = '11px';
                    summary.style.color = '#666';
                    summary.style.borderTop = '1px solid #e0e0e0';
                    summary.style.paddingTop = '10px';
                    
                    const summaryParts = [];
                    if (selectedLevels[1]) summaryParts.push(`Immediate: ${counts[1]}`);
                    if (selectedLevels[2]) summaryParts.push(`Supporting: ${counts[2]}`);
                    
                    summary.innerHTML = `
                        <em>Showing ${totalCount} Prerequisites<br>
                        ${summaryParts.join(', ')}</em>
                    `;
                    content.appendChild(summary);
                }
            }
            
            // Show the panel
            panel.classList.add('show');
        }
        
        // Modal functions
        function showModal(code) {
            const data = competencyData[code];
            if (!data) return;
            
            const modal = document.getElementById('detailModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalTableBody = document.getElementById('modalTableBody');
            const modalContent = modal.querySelector('.modal-content');
            
            modalTitle.textContent = `${code} - Details`;
            
            // Clear any existing content beyond the header
            const existingTables = modalContent.querySelectorAll('.modal-table, .modal-section-header');
            existingTables.forEach(el => el.remove());
            
            // Create main competency table
            const mainTable = document.createElement('table');
            mainTable.className = 'modal-table';
            mainTable.innerHTML = `
                <thead>
                    <tr>
                        <th>Competency Statement</th>
                        <th>Common Misconceptions</th>
                        <th>Misconception Example</th>
                        <th>Reasoning</th>
                        <th>Video</th>
                        <th>Quiz</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            `;
            
            const tbody = mainTable.querySelector('tbody');
            const row = tbody.insertRow();
            
            // Competency statement
            row.insertCell(0).textContent = data.competency;
            
            // Format misconceptions, examples, and reasoning with dotted separators
            const misconceptions = data.misconception ? data.misconception.split('\n').filter(m => m.trim()) : [];
            const examples = data.misconceptionExample ? data.misconceptionExample.split('\n').filter(e => e.trim()) : [];
            const reasonings = data.reasoning ? data.reasoning.split('\n').filter(r => r.trim()) : [];
            
            // Misconceptions column
            const misconceptionCell = row.insertCell(1);
            misconceptions.forEach((m, idx) => {
                const div = document.createElement('div');
                div.className = 'misconception-item';
                div.textContent = m.trim();
                misconceptionCell.appendChild(div);
            });
            
            // Examples column
            const exampleCell = row.insertCell(2);
            examples.forEach((e, idx) => {
                const div = document.createElement('div');
                div.className = 'misconception-item';
                div.textContent = e.trim();
                exampleCell.appendChild(div);
            });
            
            // Reasoning column
            const reasoningCell = row.insertCell(3);
            reasonings.forEach((r, idx) => {
                const div = document.createElement('div');
                div.className = 'misconception-item';
                div.textContent = r.trim();
                reasoningCell.appendChild(div);
            });
            
            // Video column (make it clickable)
            const videoCell = row.insertCell(4);
            if (data.learningResource) {
                const link = document.createElement('a');
                link.href = data.learningResource;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                link.className = 'learning-resource-link';
                link.textContent = 'Watch Video';
                videoCell.appendChild(link);
            } else {
                videoCell.textContent = 'N/A';
            }
            
            // Quiz column - add button only for competencies with quizzes
const quizCell = row.insertCell(5);
if (quizDatabase[code]) {
    const quizBtn = document.createElement('button');
    quizBtn.className = 'quiz-btn';
    quizBtn.textContent = 'Preview Quiz';
    quizBtn.onclick = () => {
        closeModal(); // Close the modal first
        launchQuiz(code); // Then launch the quiz
    };
    quizCell.appendChild(quizBtn);
} else {
    quizCell.textContent = 'Coming Soon';
}
            
            // Add the main table to modal
            modalContent.appendChild(mainTable);
            
            // Get prerequisite levels
            const levels = calculatePrerequisiteLevels(code);
            
            // Add Immediate Prerequisites section if any
            if (levels[1].length > 0) {
                const header = document.createElement('div');
                header.className = 'modal-section-header';
                header.textContent = 'Immediate Prerequisites';
                modalContent.appendChild(header);
                
                const prereqTable = createPrerequisiteTable(levels[1]);
                modalContent.appendChild(prereqTable);
            }
            
            // Add Supporting Prerequisites section if any
            if (levels[2].length > 0) {
                const header = document.createElement('div');
                header.className = 'modal-section-header';
                header.textContent = 'Supporting Prerequisites';
                modalContent.appendChild(header);
                
                const prereqTable = createPrerequisiteTable(levels[2]);
                modalContent.appendChild(prereqTable);
            }
            
            modal.classList.add('show');
        }
        
        function createPrerequisiteTable(prerequisites) {
            const table = document.createElement('table');
            table.className = 'modal-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Competency</th>
                        <th>Grade</th>
                        <th>Chapter</th>
                        <th>Sub-section</th>
                        <th>Video</th>
                        <th>Quiz</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            `;
            
            const tbody = table.querySelector('tbody');
            prerequisites.forEach(prereq => {
                const row = tbody.insertRow();
                const prereqData = competencyData[prereq.code];
                
                // Competency (code + statement)
                const compCell = row.insertCell(0);
                compCell.innerHTML = `<strong>${prereq.code}</strong><br>${prereqData ? prereqData.competency : prereq.name}`;
                
                // Grade
                row.insertCell(1).textContent = prereq.grade;
                
                // Chapter
                row.insertCell(2).textContent = prereqData && prereqData.chapter ? prereqData.chapter : '';
                
                // Sub-section
                row.insertCell(3).textContent = prereqData && prereqData.subsection ? prereqData.subsection : '';
                
                // Video
                const videoCell = row.insertCell(4);
                if (prereqData && prereqData.learningResource) {
                    const link = document.createElement('a');
                    link.href = prereqData.learningResource;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    link.className = 'learning-resource-link';
                    link.textContent = 'Watch Video';
                    videoCell.appendChild(link);
                } else {
                    videoCell.textContent = '';
                }
                
                // Quiz
                row.insertCell(5).textContent = '';
            });
            
            return table;
        }
        
        function closeModal() {
            const modal = document.getElementById('detailModal');
            modal.classList.remove('show');
        }
        
        // Click outside modal to close
        window.onclick = function(event) {
            const modal = document.getElementById('detailModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // Zoom controls
        function zoomIn() {
            window.svg.transition().duration(300).call(window.zoom.scaleBy, 1.3);
        }
        
        function zoomOut() {
            window.svg.transition().duration(300).call(window.zoom.scaleBy, 0.7);
        }
        
        function resetZoom() {
            window.svg.transition().duration(750).call(
                window.zoom.transform,
                d3.zoomIdentity
            );
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', initializeVisualization);
        
        // Handle resize
        window.addEventListener('resize', () => {
            // SVG size remains fixed for scrolling
        });
    </script>
</body>

</html>
